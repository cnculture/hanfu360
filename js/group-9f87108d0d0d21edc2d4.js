(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["group"],{"0670":function(t,e,n){},"077b":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-group-post-create"},[n("common-header",[t._v("\n    发帖\n    "),n("span",{staticClass:"primary",class:{disabled:t.disabled},attrs:{slot:"right"},on:{click:t.onSubmit},slot:"right"},[t._v("发布")])]),t.groupId?t._e():n("section",{staticClass:"form-select-item"},[n("label",[t._v("选择圈子")]),n("div",{staticClass:"input-wrap",on:{click:t.selectGroup}},[n("span",{staticClass:"placeholder"},[t._v(t._s(t.group.name))]),n("svg",{staticClass:"m-style-svg m-svg-def m-entry-append"},[n("use",{attrs:{"xlink:href":"#icon-arrow-right"}})])])]),n("main",[n("div",{staticClass:"title-wrap"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],attrs:{type:"text",placeholder:"输入标题，20字以内",maxlength:"20"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),n("div",{staticClass:"content-wrap"},[n("div",{staticClass:"textarea-shadow"},[t._v(t._s(t.content))]),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],attrs:{placeholder:"输入要说的话",rows:"1"},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}})])]),t.group.allow_feed?n("form-switch-item",{staticClass:"form-switch-item",attrs:{label:"同步至动态"},model:{value:t.feed,callback:function(e){t.feed=e},expression:"feed"}}):t._e(),t.groupId?t._e():n("choose-group",{ref:"chooseGroup",on:{change:t.onGroupChange}})],1)},r=[],o=(n("a481"),n("c5f6"),n("96cf"),n("3040")),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"popr"}},[t.visible?n("div",{staticClass:"p-choose-group"},[n("common-header",{attrs:{back:t.close}},[t._v("选择圈子")]),n("ul",{staticClass:"list"},t._l(t.list,function(e){return n("li",{key:e.id,on:{"!click":function(n){n.stopPropagation(),t.selectGroup(e)}}},[n("group-item",{attrs:{group:e}})],1)}))],1):t._e()])},a=[],c=n("74f3"),u={name:"ChooseGroup",components:{GroupItem:c["a"]},data:function(){return{visible:!1,list:[]}},created:function(){this.fetchList()},methods:{show:function(){this.visible=!0},close:function(){this.visible=!1},fetchList:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("group/getMyGroups");case 2:e=t.sent,this.list=e;case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),selectGroup:function(t){this.$emit("change",t),this.close()}}},l=u,d=(n("23e6"),n("2877")),h=Object(d["a"])(l,i,a,!1,null,"e6364b44",null);h.options.__file="ChooseGroup.vue";var f=h.exports,m={name:"GroupPostCreate",components:{ChooseGroup:f},data:function(){return{title:"",content:"",group:{},feed:!1}},computed:{groupId:function(){return this.$route.query.group},disabled:function(){return!this.groupId&&!this.group.id||(!this.title||!this.content)}},mounted:function(){this.initGroup()},methods:{onSubmit:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.disabled){t.next=2;break}return t.abrupt("return");case 2:return e={groupId:this.groupId||this.group.id,title:this.title,body:this.content,summary:this.content,sync_feed:Number(this.feed)},t.next=5,this.$store.dispatch("group/createPost",e);case 5:n=t.sent,n&&(this.$Message.success(n.message),this.$router.replace({name:"groupPostDetail",params:{groupId:n.post.group_id,postId:n.post.id}}));case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),initGroup:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.group.id&&this.groupId&&(this.group=this.$store.state.group.current),this.group.id||!this.groupId){t.next=5;break}return t.next=4,this.$store.dispatch("group/getGroupById",{groupId:this.groupId});case 4:this.group=t.sent;case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),selectGroup:function(){this.$refs.chooseGroup.show()},onGroupChange:function(t){this.group=t}}},p=m,g=(n("67f2"),Object(d["a"])(p,s,r,!1,null,"2ceac388",null));g.options.__file="GroupPostCreate.vue";e["default"]=g.exports},"0b84":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-group-detail",class:{"show-slide":t.showSlide},on:{mousedown:t.startDrag,touchstart:t.startDrag,mousemove:function(e){return e.stopPropagation(),t.onDrag(e)},touchmove:function(e){return e.stopPropagation(),t.onDrag(e)},mouseup:t.stopDrag,touchend:t.stopDrag,mouseleave:t.stopDrag}},[n("header",{ref:"head",staticClass:"m-box m-lim-width m-pos-f m-head-top bg-transp",class:{"show-title":t.scrollTop>.5*t.bannerHeight}},[n("div",{staticClass:"m-box m-flex-grow1 m-aln-center m-flex-base0"},[n("svg",{staticClass:"m-style-svg m-svg-def mr10",on:{click:t.goBack}},[n("use",{attrs:{"xlink:href":"#icon-back"}})]),n("circle-loading",{directives:[{name:"show",rawName:"v-show",value:t.updating,expression:"updating"}],attrs:{color:"light"}})],1),n("div",{staticClass:"m-box m-flex-grow1 m-aln-center m-flex-base0 m-justify-center"}),n("div",{staticClass:"m-box m-flex-grow1 m-aln-center m-flex-base0 m-justify-end"},[n("svg",{staticClass:"m-style-svg m-svg-def",on:{click:t.onSearchClick}},[n("use",{attrs:{"xlink:href":"#icon-search"}})]),n("svg",{staticClass:"m-style-svg m-svg-def",on:{click:t.onMoreClick}},[n("use",{attrs:{"xlink:href":"#icon-more"}})])])]),t.loading?n("div",{staticClass:"m-pos-f m-spinner"},[n("div"),n("div")]):t._e(),n("main",{staticStyle:{"overflow-x":"hidden","overflow-y":"auto","min-height":"100vh"}},[n("div",{ref:"banner",staticClass:"p-group-detail-banner",style:[t.groupBackGround,t.paddingTop,{transitionDuration:t.dragging?"0s":"300ms"}]},[n("div",{staticClass:"m-box m-aln-end m-justify-st m-pos-f p-group-detail-bg-mask"},[n("div",{staticClass:"p-group-detail-avatar"},[n("img",{attrs:{src:t.groupAvatar}})]),n("div",{staticClass:"m-box-model m-flex-grow1 m-flex-shrink1 m-flex-base0"},[n("h3",[t._v(t._s(t.group.name))]),n("p",[n("span",{attrs:{append:"",to:"member",tag:"span"}},[t._v("成员:"),n("i",[t._v(t._s(t.groupUserCount))])])]),n("p",[n("span",{staticClass:"m-text-cut address",attrs:{append:"",to:"followings",tag:"span"}},[t._v("地址:"),n("address",[t._v(t._s(t.location))])])])]),n("div",{staticClass:"m-box m-aln-center m-flex-grow0 m-flex-shink0 group-item-action c_fff"},[t.joined?t._e():n("button",{staticClass:"m-text-cut",attrs:{disabled:t.loading},on:{click:t.beforeJoined}},[n("svg",{staticClass:"m-style-svg m-svg-def",style:t.loading?{}:{width:"0.2rem",height:"0.2rem"}},[n("use",{attrs:{"xlink:href":"#icon-"+(t.loading?"loading":"plus")}})]),n("span",[t._v("加入")])])])])]),n("div",{staticClass:"m-text-box p-group-detail-info"},[n("p",[t._v("圈主："),n("span",[t._v(t._s(t.groupOwner.name))])]),n("p",[t._v("简介："),n("span",[t._v(t._s(t.summary))])])]),n("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.hidenFilter,expression:"hidenFilter"}],staticClass:"m-box m-aln-center m-justify-bet p-group-detail-filter-box",on:{click:function(e){t.showFilter=!t.showFilter}}},[n("span",[t._v("帖子数量"),n("em",[t._v(t._s(t.groupPostsCount))])]),n("div",{staticClass:"m-box m-aln-center p-group-detail-filter"},[n("span",[t._v(t._s(t.feedTypes[t.screen]))]),n("svg",{staticClass:"m-style-svg m-svg-small"},[n("use",{attrs:{"xlink:href":"#icon-list"}})]),t.showFilter?n("transition",[n("ul",{staticClass:"p-group-detail-filter-options"},t._l(t.feedTypes,function(e,s){return n("li",{key:s,staticClass:"m-box m-aln-center m-justify-bet",on:{click:function(e){t.screen=s}}},[n("span",[t._v(t._s(e))]),t.screen===s?n("svg",{staticClass:"m-style-svg m-svg-small"},[n("use",{attrs:{"xlink:href":"#icon-yes"}})]):t._e()])}))]):t._e()],1)]),n("ul",{staticClass:"p-group-detail-feeds"},[t._l(t.pinneds,function(e){return n("li",{key:"gdf-"+t.groupId+"-pinned-feed-"+e.id},[n("group-feed-card",{attrs:{pinned:!0,feed:e,group:t.group},on:{reload:t.updateData}})],1)}),t._l(t.posts,function(e,s){return n("li",{key:"gdf-"+t.groupId+"-feed-"+e.id+"-"+s},[n("group-feed-card",{attrs:{feed:e,group:t.group},on:{reload:t.updateData}})],1)})],2),n("div",{staticClass:"m-box m-aln-center m-justify-center load-more-box"},[t.noMoreData?n("span",{staticClass:"load-more-ph"},[t._v("---没有更多---")]):n("span",{staticClass:"load-more-btn",on:{click:function(e){e.stopPropagation(),t.getFeeds(!0)}}},[t._v("\n        "+t._s(t.fetchFeeding?"加载中...":"点击加载更多")+"\n      ")])])]),n("aside",{staticClass:"slide-more"},[n("ul",{staticClass:"list"},[n("li",{on:{click:function(e){t.$router.push({name:"groupMembers"})}}},[n("span",[n("svg",{staticClass:"m-style-svg m-svg-small"},[n("use",{attrs:{"xlink:href":"#icon-group-members"}})]),t._v("\n          成员\n        ")]),n("span",[t._v("\n          "+t._s(t.group.users_count-t.group.blacklist_count)+"\n          "),n("svg",{staticClass:"m-style-svg m-svg-small"},[n("use",{attrs:{"xlink:href":"#icon-arrow-right"}})])])]),n("li",{on:{click:function(e){t.$router.push({name:"groupInfo"})}}},[n("span",[n("svg",{staticClass:"m-style-svg m-svg-small"},[n("use",{attrs:{"xlink:href":"#icon-group-info"}})]),t._v("\n          详细信息\n        ")]),n("span",[n("svg",{staticClass:"m-style-svg m-svg-small"},[n("use",{attrs:{"xlink:href":"#icon-arrow-right"}})])])]),t.isOwner?n("li",{on:{click:function(e){t.$router.push({name:"groupPermission"})}}},[n("span",[n("svg",{staticClass:"m-style-svg m-svg-small"},[n("use",{attrs:{"xlink:href":"#icon-group-access"}})]),t._v("\n          发帖权限\n        ")]),n("span",[n("svg",{staticClass:"m-style-svg m-svg-small"},[n("use",{attrs:{"xlink:href":"#icon-arrow-right"}})])])]):t._e(),t.isGroupManager?n("li",{on:{click:function(e){t.$router.push({name:"groupBlackList"})}}},[n("span",[n("svg",{staticClass:"m-style-svg m-svg-small"},[n("use",{attrs:{"xlink:href":"#icon-group-blacklist"}})]),t._v("\n          黑名单\n        ")]),n("span",[t._v("\n          "+t._s(t.group.blacklist_count)+"\n          "),n("svg",{staticClass:"m-style-svg m-svg-small"},[n("use",{attrs:{"xlink:href":"#icon-arrow-right"}})])])]):t._e()]),t.isOwner?n("button",{staticClass:"btn-quit",on:{click:t.onTransfer}},[t._v("转让圈子")]):n("button",{staticClass:"btn-quit",on:{click:t.onExit}},[t._v("退出圈子")])]),n("div",{staticClass:"slide-mask",on:{click:function(e){t.showSlide=!1}}}),n("button",{staticClass:"create-post",on:{click:t.onCreatePostClick}},[n("svg",{staticClass:"m-style-svg m-svg-def white"},[n("use",{attrs:{"xlink:href":"#icon-plus"}})])])])},r=[],o=(n("a481"),n("96cf"),n("3040")),i=n("8afe"),a=(n("7f7f"),n("6762"),n("2fdb"),n("28a5"),n("2ef0")),c=n.n(a),u=n("265e"),l=n("23ba"),d={name:"GroupDetail",directives:{clickoutside:{bind:function(t,e){function n(n){if(t.contains(n.target))return!1;e.expression&&e.value(n)}t.__vueClickOutside__=n,document.addEventListener("click",n)},unbind:function(t){document.removeEventListener("click",t.__vueClickOutside__),delete t.__vueClickOutside__}}},components:{GroupFeedCard:u["a"]},data:function(){return{preGID:0,scrollTop:0,bannerHeight:0,loading:!0,dY:0,startY:0,dragging:!1,updating:!1,typeFilter:null,showFilter:!1,screen:"latest_post",feedTypes:{latest_post:"最新帖子",latest_reply:"最新回复"},noMoreData:!1,fetchFeeding:!1,posts:[],pinneds:[],showSlide:!1}},computed:{groupId:function(){return this.$route.params.groupId},group:function(){return this.$store.state.group.current},currentUser:function(){return this.$store.state.CURRENTUSER},groupOwner:function(){return(this.group.founder||{user:{}}).user},groupUserCount:function(){return~~this.group.users_count},groupPostsCount:function(){return~~this.group.posts_count},summary:function(){var t=this.group.summary||"";return t},groupAvatar:function(){var t=this.group.avatar||{};return t.url||null},groupBackGround:function(){return{"background-image":this.groupAvatar?'url("'.concat(this.groupAvatar,'")'):""}},location:function(){var t=this.group.location;if(t)return t;var e=["水星","金星","火星","土星","地球"],n=Math.floor(Math.random()*e.length);return e[n]},paddingTop:function(){return{paddingTop:(this.bannerHeight+80*Math.atan(this.dY/200))/(2*this.bannerHeight)*100+"%"}},joined:function(){return this.group.joined||!1},role:function(){return!!this.joined&&this.joined.role},permissions:function(){return this.group.permissions.split(",")},isOwner:function(){return this.groupOwner.id===this.currentUser.id},isGroupManager:function(){var t=this.group.joined||{},e=t.role,n=void 0===e?"":e;return["founder","administrator"].includes(n)}},watch:{$route:function(t,e){"groupDetail"!==e.name&&(this.showSlide=e.meta.sidebar)},screen:function(){this.getFeeds()}},mounted:function(){this.typeFilter=this.$refs.typeFilter,this.bannerHeight=this.$refs.banner.getBoundingClientRect().height},activated:function(){this.groupId!==this.group.id&&(this.loading=!0,this.pinneds=[],this.posts=[],this.updateData()),window.addEventListener("scroll",this.onScroll)},deactivated:function(){this.showFilter=!1,window.removeEventListener("scroll",this.onScroll)},destroyed:function(){window.removeEventListener("scroll",this.onScroll)},methods:{beforeJoined:function(){var t=this;this.joined||this.loading||(this.loading=!0,this.$store.dispatch("group/joinGroup",{groupId:this.groupId,needPaid:this.needPaid}).then(function(e){t.loading=!1,t.$Message.success(e),t.updateData()}).catch(function(){t.loading=!1}))},hidenFilter:function(){this.showFilter=!1},getFeeds:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.fetchFeeding){this.fetchFeeding=!0;var n=e?this.pinneds.length+this.posts.length:0;Object(l["k"])(this.groupId,this.screen,10,n).then(function(n){var s=n.pinneds,r=void 0===s?[]:s,o=n.posts,a=void 0===o?[]:o;t.posts=e?Object(i["a"])(t.posts).concat(Object(i["a"])(a)):a,t.pinneds=e?Object(i["a"])(t.pinneds).concat(Object(i["a"])(r)):r,t.fetchFeeding=!1,t.noMoreData=a.length<3})}},updateData:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.dY=0,this.updating=!0,this.getFeeds(),t.next=5,this.$store.dispatch("group/getGroupById",{groupId:this.groupId});case 5:this.updating=this.loading=!1;case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),onScroll:c.a.debounce(function(){this.scrollTop=Math.max(0,document.body.scrollTop,document.documentElement.scrollTop)},1e3/60),startDrag:function(t){t=t.changedTouches?t.changedTouches[0]:t,this.scrollTop<=0&&!this.updating&&(this.startY=t.pageY,this.dragging=!0)},onDrag:function(t){var e=t.changedTouches?t.changedTouches[0]:t;this.dragging&&e.pageY-this.startY>0&&window.scrollY<=0&&(t.preventDefault(),this.dY=e.pageY-this.startY)},stopDrag:function(){this.dragging=!1,this.dY>300&&this.scrollTop<=0?this.updateData():this.dY=0},onSearchClick:function(){this.$router.push({name:"groupSearchPost",params:{groupId:this.groupId}})},onMoreClick:function(){this.showSlide=!this.showSlide},onCreatePostClick:function(){if(!this.joined)return this.$bus.$emit("actionSheet",[],"知道了","需要先加入才可发帖");if(!this.permissions.includes(this.role)){var t=this.permissions.includes("administrator")?"圈主和管理员":"圈主",e='"'.concat(this.group.name,'"仅').concat(t,"拥有发帖权限");return this.$bus.$emit("actionSheet",[],"知道了",e)}this.$router.push({name:"groupCreatePost",query:{group:this.groupId}})},onExit:function(){var t=this,e=[{text:"退出圈子",method:function(){t.exitGroup()},style:{color:"red"}}];this.$bus.$emit("actionSheet",e,"取消","确定要退出圈子吗?")},exitGroup:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("group/exitGroup",{groupId:this.groupId});case 2:this.$Message.success("退出圈子成功"),this.$router.replace({name:"groupHome"});case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),onTransfer:function(){this.$router.push({name:"groupTransfer"})}}},h=d,f=(n("a46e"),n("2877")),m=Object(f["a"])(h,s,r,!1,null,"0c7a10ad",null);m.options.__file="GroupDetail.vue";e["default"]=m.exports},"136e":function(t,e,n){},"169f":function(t,e,n){"use strict";var s=n("da23"),r=n.n(s);r.a},"174f":function(t,e,n){"use strict";var s=n("8fd6"),r=n.n(s);r.a},1754:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-group-members"},[n("search-bar",{staticClass:"search-bar",model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),t.keyword.length?[n("ul",t._l(t.searchList,function(e){return n("li",{key:e.id},[n("group-user-item",{attrs:{member:e},on:{more:function(n){t.onMoreClick(e)}}})],1)}))]:[n("h3",[t._v("圈管理("+t._s(t.administrator.length)+")")]),n("ul",t._l(t.administrator,function(e){return n("li",{key:e.id},[n("group-user-item",{attrs:{member:e},on:{more:function(n){t.onMoreClick(e)}}})],1)})),n("h3",[t._v("成员("+t._s(t.member.length)+")")]),n("ul",t._l(t.member,function(e){return n("li",{key:e.id},[n("group-user-item",{attrs:{member:e},on:{more:function(n){t.onMoreClick(e)}}})],1)}))]],2)},r=[],o=(n("55dd"),n("ac6a"),n("9393")),i=(n("96cf"),n("3040")),a=(n("c5f6"),n("2ef0")),c=n.n(a),u=n("3d8d"),l=n("cb6f"),d={name:"GroupMembers",components:{SearchBar:u["a"],GroupUserItem:l["a"]},data:function(){return{keyword:"",member:[],administrator:[],searchList:[]}},computed:{group:function(){return this.$store.state.group.current},groupId:function(){return Number(this.$route.params.groupId)}},watch:{keyword:function(t,e){if(""===t.trim())return this.searchList=[];t.trim()!==e.trim()&&this.searchUser(t)}},created:function(){this.group.id||this.fetchGroup(),this.fetchMembers()},methods:{fetchMembers:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e,n,s,r,i,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this.$store.dispatch("group/getMembers",{groupId:this.groupId,type:"manager",limit:100}),n=this.$store.dispatch("group/getMembers",{groupId:this.groupId,type:"member",limit:100}),t.next=4,Promise.all([e,n]);case 4:s=t.sent,r=Object(o["a"])(s,2),i=r[0],a=r[1],this.member=a,this.administrator=i.sort(function(t){return"founder"!==t.role});case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),fetchGroup:function(){this.$store.dispatch("group/getGroupById",{groupId:this.groupId})},searchUser:c.a.debounce(function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.searchList=[],t.next=3,this.$store.dispatch("group/getMembers",{groupId:this.groupId,name:e});case 3:n=t.sent,this.searchList=n;case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),600),onMoreClick:function(t){var e=this,n=[];"member"===t.role&&n.push({text:"加入黑名单",method:function(){var n=[{text:"加入黑名单",method:function(){var n=Object(i["a"])(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$store.dispatch("group/addToBlackList",{groupId:e.groupId,memberId:t.id});case 2:e.member=e.member.filter(function(e){return e.id!==t.id}),e.$Message.success("操作成功"),e.fetchMembers();case 5:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}()}];setTimeout(function(){e.$bus.$emit("actionSheet",n,"取消","确认加入黑名单？")},200)}}),n.length&&this.$bus.$emit("actionSheet",n)}}},h=d,f=(n("c75e"),n("2877")),m=Object(f["a"])(h,s,r,!1,null,"45cc2c04",null);m.options.__file="GroupMembers.vue";e["default"]=m.exports},"19ab":function(t,e,n){},"1f1e":function(t,e,n){},"210b":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-group-info"},[n("common-header",[t._v("详细信息")]),n("form",[n("form-avatar-item",{attrs:{readonly:!0,label:"圈子头像",shape:"square",type:"storage"},model:{value:t.group.avatar,callback:function(e){t.$set(t.group,"avatar",e)},expression:"group.avatar"}}),n("form-input-item",{attrs:{readonly:!0,label:"圈名"},model:{value:t.group.name,callback:function(e){t.$set(t.group,"name",e)},expression:"group.name"}}),n("form-input-item",{attrs:{readonly:!0,label:"分类"},model:{value:t.category.name,callback:function(e){t.$set(t.category,"name",e)},expression:"category.name"}}),n("form-tags-item",{attrs:{readonly:!0},model:{value:t.group.tags,callback:function(e){t.$set(t.group,"tags",e)},expression:"group.tags"}}),n("form-input-item",{attrs:{readonly:!0,type:"textarea",label:"位置"},model:{value:t.location,callback:function(e){t.location=e},expression:"location"}}),n("form-input-item",{attrs:{readonly:!0,type:"textarea",label:"简介"},model:{value:t.group.summary,callback:function(e){t.$set(t.group,"summary",e)},expression:"group.summary"}}),n("hr"),n("form-input-item",{attrs:{readonly:!0,type:"textarea",label:"公告"},model:{value:t.group.notice,callback:function(e){t.$set(t.group,"notice",e)},expression:"group.notice"}})],1)],1)},r=[],o={name:"GroupInfo",computed:{group:function(){return this.$store.state.group.current||{}},groupId:function(){return this.$route.params.groupId},category:function(){return this.group.category||{}},location:function(){var t=this.group.location;return t||"不显示位置"}},created:function(){this.group.id||this.fetchGroupInfo()},methods:{fetchGroupInfo:function(){this.$store.dispatch("group/getGroupById",{groupId:this.groupId})}}},i=o,a=(n("877f"),n("2877")),c=Object(a["a"])(i,s,r,!1,null,"99c122ce",null);c.options.__file="GroupInfo.vue";e["default"]=c.exports},2251:function(t,e,n){},2277:function(t,e,n){},"23e6":function(t,e,n){"use strict";var s=n("2277"),r=n.n(s);r.a},"265e":function(t,e,n){"use strict";n("6762"),n("2fdb");var s,r,o=n("8afe"),i=(n("a481"),n("00d3")),a=n("23ba"),c={name:"GroupFeedCard",extends:i["a"],props:{group:{type:Object,default:function(){}}},computed:{post:function(){return this.feed||{}},currentUser:function(){return this.$store.state.CURRENTUSER},liked:{get:function(){return!!this.feed.liked},set:function(t){this.feed.liked=t}},commentCount:{get:function(){return this.feed.comments_count||0},set:function(t){this.feed.comments_count=~~t}},likeCount:{get:function(){return this.feed.likes_count||0},set:function(t){this.feed.likes_count=~~t}},body:function(){var t=this.feed.summary||"";return t.replace(/@!\[image\]\(\d+\)/g,"")},images:function(){var t=[];return this.feed.images.map(function(e){e.file=e.id,t=Object(o["a"])(t).concat([e])}),t||[]},has_collect:{get:function(){return this.feed.collected||0},set:function(t){this.feed.collected=t}},viewCount:function(){return this.feed.views_count||0},isGroupOwner:function(){return this.group.founder.user_id===this.currentUser.id},isGroupManager:function(){var t=this.group.joined||{},e=t.role,n=void 0===e?"":e;return["founder","administrator"].includes(n)}},methods:{handleView:function(){this.$router.push("/groups/".concat(this.feed.group.id,"/posts/").concat(this.feed.id))},handleLike:function(){var t=this,e=this.liked?"delete":"post",n="/plus-group/group-posts/".concat(this.feed.id,"/likes");this.fetching||(this.fetching=!0,this.$http({method:e,url:n,validateStatus:function(t){return 201===t||204===t}}).then(function(){"post"===e?(t.liked=!0,t.likeCount+=1):(t.liked=!1,t.likeCount-=1),t.fetching=!1}).catch(function(){t.fetching=!1}))},sendComment:function(t){var e=this,n=t.reply_user,s=t.body;if(s&&0===s.length)return this.$Message.error("评论内容不能为空");var r={body:s,reply_user:n};a["D"](this.feed.id,r).then(function(t){e.commentCount+=1,e.comments.unshift(t),e.comments.length>5&&e.comments.pop(),e.$Message.success("评论成功"),e.$bus.$emit("commentInput:close",!0)})},handleCollection:function(){var t=this;a["e"](this.feed.id,this.has_collect).then(function(){t.$Message.success("操作成功"),t.has_collect=!t.has_collect})},handleMore:function(){var t=this,e=[];this.has_collect?e.push({text:"取消收藏",method:function(){a["J"](t.feed.id).then(function(){t.$Message.success("取消收藏"),t.has_collect=!1})}}):e.push({text:"收藏",method:function(){a["f"](t.feed.id).then(function(){t.$Message.success("已加入我的收藏"),t.has_collect=!0})}}),this.isGroupManager?this.pinned?e.push({text:"撤销置顶",method:function(){var e=[{text:"撤销置顶",method:function(){t.$store.dispatch("group/unpinnedPost",{postId:t.feed.id}).then(function(){t.$Message.success("撤销置顶成功！"),t.$emit("reload")})}}];setTimeout(function(){t.$bus.$emit("actionSheet",e,"取消","确认撤销置顶?")},200)}}):e.push({text:"置顶帖子",method:function(){t.$bus.$emit("applyTop",{type:"post-manager",api:a["C"],payload:t.feed.id,callback:function(){t.$Message.success("置顶成功！"),t.$emit("reload")}})}}):this.isMine&&!this.pinned&&e.push({text:"申请帖子置顶",method:function(){t.$bus.$emit("applyTop",{type:"post",api:a["b"],payload:t.feed.id})}}),(this.isMine||this.isGroupManager)&&e.push({text:"删除帖子",method:function(){setTimeout(function(){var e=[{text:"删除",style:{color:"#f4504d"},method:function(){t.$store.dispatch("group/deletePost",{groupId:t.feed.group.id,postId:t.feed.id}).then(function(){t.$Message.success("删除帖子成功"),t.$nextTick(function(){t.$el.remove(),t.$emit("afterDelete")})})}}];t.$bus.$emit("actionSheet",e,"取消","确认删除?")},200)}}),this.isMine||e.push({text:"举报",method:function(){t.$Message.info("举报功能开发中，敬请期待")}}),this.$bus.$emit("actionSheet",e,"取消")},commentAction:function(t){var e=this,n=t.isMine,s=void 0!==n&&n,r=t.placeholder,o=t.reply_user,i=t.comment;if(s){var c=this.feed.user.id===this.CURRENTUSER.id;this.$bus.$emit("actionSheet",[{text:c?"评论置顶":"申请评论置顶",method:function(){e.$bus.$emit("applyTop",{isOwner:c,type:"postComment",api:a["c"],payload:{postId:e.feedID,commentId:i.id}})}},{text:"删除评论",method:function(){return e.deleteComment(i.id)}}])}else this.handleComment({placeholder:r,reply_user:o})},deleteComment:function(t){var e=this;this.$store.dispatch("group/deletePostComment",{postId:this.feedID,commentId:t}).then(function(){e.feed.comments=e.feed.comments.filter(function(e){return e.id!==t}),e.commentCount-=1,e.$Message.success("删除评论成功")})}}},u=c,l=n("2877"),d=Object(l["a"])(u,s,r,!1,null,null,null);d.options.__file="GroupFeedCard.vue";e["a"]=d.exports},2988:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("article-card",{attrs:{liked:t.liked,loading:t.loading},on:{"on-like":t.likeFeed,"on-share":t.shareFeed,"on-more":t.moreAction,"on-comment":t.commentFeed}},[n("common-header",{attrs:{slot:"head"},slot:"head"},[n("avatar",{attrs:{user:t.user,size:"tiny"}}),n("span",{staticClass:"m-text-cut m-flex-none username"},[t._v("\n      "+t._s(t.user.name)+"\n    ")]),t.isMine?t._e():n("template",{class:{c_59b6d7:"unFollow"!==t.relation.status},slot:"right"},[n("svg",{staticClass:"m-style-svg m-svg-def",on:{click:function(e){t.followUserByStatus(t.relation.status)}}},[n("use",{attrs:{"xlink:href":t.relation.icon}})])])],2),n("load-more",{ref:"loadmore",attrs:{"on-refresh":t.onRefresh}},[n("main",{staticClass:"m-flex-shrink1 m-flex-grow1 m-art m-main"},[n("div",{staticClass:"m-art-body"},[t.title?n("h2",[t._v(t._s(t.title))]):t._e(),t.video?n("video",{staticClass:"feed-detail-video",attrs:{poster:t.cover_file,controls:"",autoplay:""}},[n("source",{attrs:{src:t.video_file,type:"video/mp4"}})]):t._e(),t._l(t.images,function(e){return e.file?n("async-file",{key:e.file,attrs:{file:e.file},scopedSlots:t._u([{key:"default",fn:function(s){return s.src?n("img",{attrs:{src:s.src},on:{click:function(n){t.onFileClick(e)}}}):t._e()}}])}):t._e()}),n("p",{staticClass:"m-text-box",domProps:{innerHTML:t._s(t.formatBody(t.feedContent))}})],2),n("div",{staticClass:"m-box m-aln-center m-justify-bet m-art-foot"},[n("div",{staticClass:"m-flex-grow1 m-flex-shrink1 m-art-like-list"},[t.likeCount>0?n("router-link",{staticClass:"m-box m-aln-center",attrs:{tag:"div",to:"likers",append:""}},[n("ul",{staticClass:"m-box m-flex-grow0 m-flex-shrink0"},t._l(t.likes.slice(0,5),function(e,s){var r=e.user;void 0===r&&(r={});var o=e.id;return n("li",{key:o,staticClass:"m-avatar-box tiny",class:"m-avatar-box-"+r.sex,style:{zIndex:5-s}},[n("img",{attrs:{src:t.getAvatar(r.avatar)}})])})),n("span",[t._v(t._s(t._f("formatNum")(t.likeCount))+"人点赞")])]):t._e()],1),n("div",{staticClass:"m-box-model m-aln-end m-art-info"},[t.time?n("span",[t._v("发布于"+t._s(t._f("time2tips")(t.time)))]):t._e(),n("span",[t._v(t._s(t._f("formatNum")(t.feed.feed_view_count||0))+"浏览")])])]),n("div",{staticClass:"m-box-model m-box-center m-box-center-a m-art-reward"},[n("button",{staticClass:"m-art-rew-btn",on:{click:t.rewardFeed}},[t._v("打 赏")]),n("p",{staticClass:"m-art-rew-label"},[n("a",{attrs:{href:"javascript:;"}},[t._v(t._s(t._f("formatNum")(t.reward.count)))]),t._v("人打赏，共"),n("a",{attrs:{href:"javascript:;"}},[t._v(t._s(~~t.reward.amount))]),t._v(t._s(t.currencyUnit))]),n("router-link",{staticClass:"m-box m-aln-center m-art-rew-list",attrs:{tag:"ul",to:"rewarders",append:""}},[t._l(t.rewardList,function(e){return n("li",{key:e.id,staticClass:"m-flex-grow0 m-flex-shrink0 m-art-rew m-avatar-box tiny",class:"m-avatar-box-"+e.user.sex},[n("img",{attrs:{src:t.getAvatar(e.user.avatar)}})])}),t.rewardList.length>0?n("li",{staticClass:"m-box m-aln-center"},[n("svg",{staticClass:"m-style-svg m-svg-def",staticStyle:{fill:"#bfbfbf"}},[n("use",{attrs:{"xlink:href":"#icon-arrow-right"}})])]):t._e()],2)],1)]),n("detail-ad",{attrs:{type:"feed"}}),n("div",{staticClass:"m-box-model m-art-comments",attrs:{id:"comment_list"}},[n("ul",{staticClass:"m-box m-aln-center m-art-comments-tabs"},[n("li",[t._v(t._s(t._f("formatNum")(t.commentCount))+"条评论")])]),t._l(t.pinnedCom,function(e){return n("comment-item",{key:"pinned-comment-"+e.id,attrs:{pinned:!0,comment:e},on:{click:t.replyComment}})}),t._l(t.comments,function(e){return n("comment-item",{key:e.id,attrs:{comment:e},on:{click:t.replyComment}})}),n("div",{staticClass:"m-box m-aln-center m-justify-center load-more-box"},[t.noMoreCom?n("span",{staticClass:"load-more-ph"},[t._v("---没有更多---")]):n("span",{staticClass:"load-more-btn",on:{click:function(e){e.stopPropagation(),t.fetchFeedComments(t.maxComId)}}},[t._v("\n          "+t._s(t.fetchComing?"加载中...":"点击加载更多")+"\n        ")])])],2)],1)],1)},r=[],o=n("8afe"),i=(n("f751"),n("7f7f"),n("a481"),n("c93e")),a=n("2f62"),c=n("607e"),u=n("ae61"),l=n("9e56"),d=n("1238"),h=n("365c"),f=n("c24f"),m=n("95d8"),p={name:"FeedDetail",components:{ArticleCard:c["a"],CommentItem:u["a"],DetailAd:l["a"]},data:function(){return{feed:{},loading:!0,fetching:!1,comments:[],pinnedCom:[],rewardList:[],fetchComing:!1,noMoreCom:!1,maxComId:0,user:{}}},computed:Object(i["a"])({},Object(a["d"])(["CURRENTUSER"]),{feedID:function(){return this.$route.params.feedID},video:function(){return this.feed.video},video_file:function(){return!!this.video&&"".concat(this.$http.defaults.baseURL,"/files/").concat(this.video.video_id)},title:function(){return this.feed.title},cover_file:function(){return!!this.video&&"".concat(this.$http.defaults.baseURL,"/files/").concat(this.video.video_id)},isMine:function(){return this.feed.user_id===this.CURRENTUSER.id},likes:{get:function(){return this.feed.likes||[]},set:function(t){this.feed.likes=t}},liked:{get:function(){return!!this.feed.has_like},set:function(t){this.feed.has_like=t}},likeCount:{get:function(){return this.feed.like_count||0},set:function(t){this.feed.like_count=~~t}},commentCount:{get:function(){return this.feed.feed_comment_count||0},set:function(t){this.feed.feed_comment_count=t}},reward:function(){return this.feed.reward||{}},images:function(){return this.feed.images||[]},time:function(){return this.feed.created_at||""},feedContent:function(){return this.feed.feed_content||""},isWechat:function(){return this.$store.state.BROWSER.isWechat},has_collect:{get:function(){return this.feed.has_collect},set:function(t){this.feed.has_collect=t}},relation:{get:function(){var t={unFollow:{text:"关注",status:"unFollow",icon:"#icon-unFollow"},follow:{text:"已关注",status:"follow",icon:"#icon-follow"},eachFollow:{text:"互相关注",status:"eachFollow",icon:"#icon-eachFollow"}},e=this.user,n=e.follower,s=e.following;return t[n&&s?"eachFollow":n?"follow":"unFollow"]},set:function(t){this.user.follower=t}}}),activated:function(){this.feedID&&(this.comments=[],this.feed={},this.rewardList=[],this.fetchFeed())},deactivated:function(){this.loading=!0,this.share={title:"",desc:"",link:""},this.config={appid:"",timestamp:0,noncestr:"",signature:""}},methods:{formatBody:function(t){var e=/<\s*script\s*>(.*?)<\s*\/\s*script\s*>/i;t=t.replace(e,"&lt;script&gt;$1&lt;/script&gt;"),t=t.replace(/\n/g,"<br>");var n=/(https?|http|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/g;return t?t.replace(n,function(t){return'<a class="m-art-links" href="'.concat(t,'" target="__blank">#网页链接#</a>')}):""},fetchFeed:function(t){var e=this;if(!this.fetching){this.fetching=!0;var n=window.location.origin+"/hanfu360/".substr(0,"/hanfu360/".length-1)+this.$route.fullPath,s="IOS"===this.$store.state.BROWSER.OS?window.initUrl:n;this.$http.get("/feeds/".concat(this.feedID)).then(function(r){var o=r.data,i=void 0===o?{}:o;e.feed=i,e.fetching=!1,e.fetchUserInfo(),e.fetchFeedComments(),e.fetchRewards(),e.isWechat&&Object(d["a"])(s,{title:"".concat(i.user.name,"的动态"),desc:"".concat(i.feed_content),link:n,imgUrl:i.images.length>0?"".concat(e.$http.defaults.baseURL,"/files/").concat(i.images[0].file):""}),t&&"function"===typeof t&&t()}).catch(function(){e.goBack(),t&&"function"===typeof t&&t()})}},fetchUserInfo:function(){var t=this;Object(f["f"])(this.feed.user_id,!0).then(function(e){t.user=Object.assign({},t.user,e),t.loading=!1})},fetchFeedComments:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fetchComing||(this.fetchComing=!0,m["h"](this.feedID,{after:e}).then(function(n){var s=n.data,r=s.pinneds,i=void 0===r?[]:r,a=s.comments,c=void 0===a?[]:a;if(e)t.comments=Object(o["a"])(t.comments).concat(Object(o["a"])(c));else{t.pinnedCom=i;var u=i.map(function(t){return t.id});t.comments=c.filter(function(t){return u.indexOf(t.id)<0})}c.length&&(t.maxComId=c[c.length-1].id),t.noMoreCom=c.length!==h["b"],t.$nextTick(function(){t.fetchComing=!1,t.loading=!1})}).catch(function(){t.loading=!1,t.fetchComing=!1}))},fetchRewards:function(){var t=this;m["j"](this.feedID,{limit:10}).then(function(e){var n=e.data,s=void 0===n?[]:n;t.rewardList=s})},getAvatar:function(t){return t&&t.url||null},rewardFeed:function(){var t=this,e=function(e){t.fetchRewards(),t.feed.reward_number+=1,t.feed.reward_amount+=e};this.$bus.$emit("reward",{type:"feed",api:m["l"],payload:this.feedID,callback:e})},likeFeed:function(){var t=this,e=this.liked?"delete":"post",n=this.liked?"/feeds/".concat(this.feedID,"/unlike"):"/feeds/".concat(this.feedID,"/like");this.fetching||(this.fetching=!0,this.$http({method:e,url:n,validateStatus:function(t){return 201===t||204===t}}).then(function(){"post"===e?(t.liked=!0,t.likeCount+=1,t.likes.length<5&&(t.likes=Object(o["a"])(t.likes).concat([{user:t.CURRENTUSER,id:(new Date).getTime(),user_id:t.CURRENTUSER.id}]))):(t.liked=!1,t.likeCount-=1,t.likes=t.likes.filter(function(e){return e.user_id!==t.CURRENTUSER.id})),t.fetching=!1}).catch(function(){t.fetching=!1}))},commentFeed:function(){var t=this;this.$bus.$emit("commentInput",{onOk:function(e){t.sendComment({body:e})}})},shareFeed:function(){this.isWechat?this.$Message.success("请点击右上角微信分享😳"):this.$Message.success("请使用浏览器的分享功能😳")},moreAction:function(){var t=this,e=[{text:this.has_collect?"取消收藏":"收藏",method:function(){var e,n,s;t.has_collect?(n="取消收藏",s="delete",e="/feeds/".concat(t.feedID,"/uncollect")):(n="已加入我的收藏",s="post",e="/feeds/".concat(t.feedID,"/collections")),t.$http({url:e,method:s,validateStatus:function(t){return 204===t||201===t}}).then(function(){t.$Message.success(n),t.has_collect=!t.has_collect})}}],n=this.isMine?[{text:"申请动态置顶",method:function(){t.$bus.$emit("applyTop",{type:"feed",api:m["a"],payload:t.feedID})}},{text:"删除动态",method:function(){setTimeout(function(){var e=[{text:"删除",style:{color:"#f4504d"},method:function(){m["d"](t.feedID).then(function(){t.$Message.success("删除动态成功"),t.goBack()})}}];t.$bus.$emit("actionSheet",e,"取消","确认删除?")},200)}}]:[{text:"举报",method:function(){t.$Message.info("举报功能开发中，敬请期待")}}];this.$bus.$emit("actionSheet",e.concat(n),"取消")},replyComment:function(t,e,n){var s=this;if(t===this.CURRENTUSER.id){var r=t===this.user.id,o=[{text:r?"评论置顶":"申请评论置顶",method:function(){s.$bus.$emit("applyTop",{isOwner:r,type:"feedComment",api:m["b"],payload:{feedId:s.feedID,commentId:n},callback:s.fetchFeedComments})}},{text:"删除评论",method:function(){return s.deleteComment(n)}}];this.$bus.$emit("actionSheet",o,"取消")}else this.$bus.$emit("commentInput",{placeholder:"回复： ".concat(e),onOk:function(e){s.sendComment({reply_user:t,body:e})}})},sendComment:function(t){var e=this,n=t.reply_user,s=t.body,r={};s&&s.length>0?(r.body=s,n&&(r["reply_user"]=n),this.$http.post("/feeds/".concat(this.feedID,"/comments"),r,{validateStatus:function(t){return 201===t}}).then(function(t){var n=t.data;n=void 0===n?{comment:{}}:n;var s=n.comment;e.$Message.success("评论成功"),e.comments.unshift(s),e.commentCount+=1,e.$bus.$emit("commentInput:close",!0)}).catch(function(){e.$Message.error("评论失败"),e.$bus.$emit("commentInput:close",!0)})):this.$Message.error("评论内容不能为空")},deleteComment:function(t){var e=this;m["e"](this.feedID,t).then(function(){e.fetchFeedComments(),e.commentCount-=1,e.$Message.success("删除评论成功")})},followUserByStatus:function(t){var e=this;t&&!this.fetchFollow&&(this.fetchFollow=!0,Object(f["d"])({id:this.user.id,status:t}).then(function(t){e.relation=t,e.fetchFollow=!1}))},onRefresh:function(){var t=this;this.fetchFeed(function(){t.$refs.loadmore.topEnd()})},onFileClick:function(t){var e=this;t&&!1===t.paid&&(this.$lstore.hasData("H5_ACCESS_TOKEN")?this.$bus.$emit("payfor",{nodeType:"内容",node:t.paid_node,amount:t.amount,onSuccess:function(t){e.$Message.success(t),e.feed.images=null,e.fetchFeed()}}):this.$nextTick(function(){var t=e.$route.fullPath;e.$router.push({path:"/signin",query:{redirect:t}})}))}}},g=p,v=(n("169f"),n("2877")),b=Object(v["a"])(g,s,r,!1,null,"500756aa",null);b.options.__file="FeedDetail.vue";e["default"]=b.exports},"2a65":function(t,e,n){},"2f21":function(t,e,n){"use strict";var s=n("79e5");t.exports=function(t,e){return!!t&&s(function(){e?t.call(null,function(){},1):t.call(null)})}},3706:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-search-post"},[n("search-bar",{attrs:{position:"fixed"},model:{value:t.keywordOrigin,callback:function(e){t.keywordOrigin=e},expression:"keywordOrigin"}}),n("jo-load-more",{ref:"loadmore",staticClass:"lodemore",attrs:{"auto-load":!1,"show-bottom":t.list.length>0},on:{onRefresh:t.onSearchInput,onLoadMore:t.onLoadMore}},t._l(t.list,function(t){return n("group-feed-card",{key:t.id,attrs:{feed:t}})})),n("p",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"load-more-ph m-text-c mt10"},[t._v("正在搜索...")]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.noResult&&!t.loading&&!t.list.length,expression:"noResult && !loading && !list.length"}],staticClass:"m-no-find"})],1)},r=[],o=n("8afe"),i=(n("96cf"),n("3040")),a=n("2ef0"),c=n.n(a),u=n("3d8d"),l=n("265e"),d={name:"SearchPost",components:{SearchBar:u["a"],GroupFeedCard:l["a"]},data:function(){return{keywordOrigin:"",list:[],loading:!1,noResult:!1}},computed:{keyword:function(){return this.keywordOrigin.trim()},groupId:function(){return this.$route.params.groupId}},watch:{keyword:function(){this.onSearchInput()}},methods:{onSearchInput:c.a.debounce(Object(i["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.keyword){t.next=2;break}return t.abrupt("return");case 2:return this.loading=!0,t.next=5,this.$store.dispatch("group/searchPosts",{keyword:this.keyword,group_id:this.groupId});case 5:e=t.sent,this.loading=!1,this.list=e,this.noResult=!this.list.length,this.$refs.loadmore.afterRefresh(e.length<15);case 10:case"end":return t.stop()}},t,this)})),600),onLoadMore:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.keyword){t.next=2;break}return t.abrupt("return");case 2:return this.loading=!0,t.next=5,this.$store.dispatch("group/searchPosts",{keyword:this.keyword,group_id:this.groupId,offset:this.list.length});case 5:e=t.sent,this.loading=!1,this.list=Object(o["a"])(this.list).concat(Object(o["a"])(e)),this.$refs.loadmore.afterLoadMore(e.length<15);case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},h=d,f=(n("48fe"),n("2877")),m=Object(f["a"])(h,s,r,!1,null,"58710bb1",null);m.options.__file="GroupSearchPost.vue";e["default"]=m.exports},"386d":function(t,e,n){n("214f")("search",1,function(t,e,n){return[function(n){"use strict";var s=t(this),r=void 0==n?void 0:n[e];return void 0!==r?r.call(n,s):new RegExp(n)[e](String(s))},n]})},"3bc7":function(t,e,n){"use strict";var s=n("e954"),r=n.n(s);r.a},"3d24":function(t,e,n){},"3d5a0":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-group-permission"},[n("common-header",[t._v("发帖权限设置")]),n("main",[n("ul",{staticClass:"list"},[n("li",{class:{active:"member"===t.current},on:{click:function(e){t.current="member"}}},[t._v("所有成员")]),n("li",{class:{active:"founder"===t.current},on:{click:function(e){t.current="founder"}}},[t._v("仅圈主")]),n("li",{class:{active:"manager"===t.current},on:{click:function(e){t.current="manager"}}},[t._v("仅圈主和管理员")])])])],1)},r=[],o=(n("6762"),n("2fdb"),n("28a5"),{name:"GroupPermission",data:function(){return{current:this.remote}},computed:{groupId:function(){return this.$route.params.groupId},group:function(){return this.$store.state.group.current},remote:function(){var t=this.group.permissions||"";return t=t.split(","),t.includes("member")?"member":t.includes("administrator")?"manager":"founder"}},watch:{current:function(t,e){this.current=t,e&&this.switch(t)},remote:function(t){this.current=t}},mounted:function(){this.current=this.remote},methods:{switch:function(t){var e=["founder"];"manager"===t&&e.push("administrator"),"member"===t&&e.push("member","administrator"),this.$store.dispatch("group/changePermissions",{groupId:this.groupId,permissions:e})}}}),i=o,a=(n("97f1"),n("2877")),c=Object(a["a"])(i,s,r,!1,null,"5bc27944",null);c.options.__file="GroupPermission.vue";e["default"]=c.exports},"40b8":function(t,e,n){"use strict";var s=n("0670"),r=n.n(s);r.a},4551:function(t,e,n){"use strict";var s=n("790c"),r=n.n(s);r.a},"48fe":function(t,e,n){"use strict";var s=n("3d24"),r=n.n(s);r.a},"55dd":function(t,e,n){"use strict";var s=n("5ca1"),r=n("d8e8"),o=n("4bf8"),i=n("79e5"),a=[].sort,c=[1,2,3];s(s.P+s.F*(i(function(){c.sort(void 0)})||!i(function(){c.sort(null)})||!n("2f21")(a)),"Array",{sort:function(t){return void 0===t?a.call(o(this)):a.call(o(this),r(t))}})},"5b5d":function(t,e,n){},"607e":function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",[n("div",{staticClass:"c-article-card"},[n("div",{staticClass:"m-box-model m-art-card"},[n("header",{ref:"head",staticClass:"m-box-model m-pos-f m-head-top"},[t._t("head",[n("common-header",[t._v("资讯详情")])])],2),t.loading?n("div",{staticClass:"m-spinner pos-f"},[n("div"),n("div")]):t._e(),n("main",{staticClass:"m-box-model"},[t._t("default")],2),t.canOprate?n("footer",{ref:"foot",staticClass:"m-pos-f"},[t._t("foot",[n("a",{staticClass:"m-box-model m-aln-center",on:{click:function(e){return e.preventDefault(),t.handelLike(e)}}},[n("svg",{staticClass:"m-style-svg m-svg-def"},[n("use",{attrs:{"xlink:href":t.liked?"#icon-like":"#icon-unlike"}})]),n("span",[t._v("喜欢")])]),n("a",{staticClass:"m-box-model m-aln-center",on:{click:function(e){return e.preventDefault(),t.handelComment(e)}}},[n("svg",{staticClass:"m-style-svg m-svg-def"},[n("use",{attrs:{"xlink:href":"#icon-comment"}})]),n("span",[t._v("评论")])]),n("a",{staticClass:"m-box-model m-aln-center",on:{click:function(e){return e.preventDefault(),t.handelShare(e)}}},[n("svg",{staticClass:"m-style-svg m-svg-def"},[n("use",{attrs:{"xlink:href":"#icon-share"}})]),n("span",[t._v("分享")])]),n("a",{staticClass:"m-box-model m-aln-center",on:{click:function(e){return e.preventDefault(),t.handelMore(e)}}},[n("svg",{staticClass:"m-style-svg m-svg-def"},[n("use",{attrs:{"xlink:href":"#icon-more"}})]),n("span",[t._v("更多")])])])],2):t._e()])])])},r=[],o=n("7b46"),i=n.n(o),a={name:"ArticleCard",props:{loading:{type:Boolean,default:!0},liked:{type:Boolean,default:!1},canOprate:{type:Boolean,default:!0}},data:function(){return{headroom:null,footroom:null}},computed:{isWechat:function(){return this.$store.state.BROWSER.isWechat}},watch:{canOprate:function(t){var e=this;t&&this.$nextTick(function(){e.footroot||(e.footroom=new i.a(e.$refs.foot,{tolerance:5,offset:50,classes:{initial:"headroom-foot",pinned:"headroom--footShow",unpinned:"headroom--footHide"}})),e.footroom.init()})}},mounted:function(){var t=this;this.headroom=new i.a(this.$refs.head,{tolerance:5,offset:50,classes:{initial:"headroom-head",pinned:"headroom--headShow",unpinned:"headroom--headHide"}}),this.headroom.init(),this.canOprate&&this.$nextTick(function(){t.footroom=new i.a(t.$refs.foot,{tolerance:5,offset:50,classes:{initial:"headroom-foot",pinned:"headroom--footShow",unpinned:"headroom--footHide"}}),t.footroom.init()})},methods:{handelLike:function(){this.$emit("on-like")},handelComment:function(){this.$emit("on-comment")},handelShare:function(){this.$emit("on-share")},handelMore:function(){this.$emit("on-more")},goback:function(){this.$router.go(-1)}}},c=a,u=(n("dcef"),n("2877")),l=Object(u["a"])(c,s,r,!1,null,"2a7162ac",null);l.options.__file="ArticleCard.vue";e["a"]=l.exports},"611b":function(t,e,n){"use strict";var s=n("6900"),r=n.n(s);r.a},"67be":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-group-search"},[n("search-bar",{staticClass:"search-bar",model:{value:t.keywordOrigin,callback:function(e){t.keywordOrigin=e},expression:"keywordOrigin"}}),n("nav-tab",{staticClass:"nav-tab",attrs:{nav:t.nav,route:{name:"groupSearch",query:"type"}}}),n("jo-load-more",{ref:"loadmore",staticClass:"loadmore",attrs:{"auto-load":!1,"show-bottom":t.list.length>0},on:{onRefresh:t.onSearchInput,onLoadMore:t.onLoadMore}},["posts"===t.type?t._l(t.list,function(t){return n("group-feed-card",{key:t.id,attrs:{feed:t}})}):"groups"===t.type&&t.keyword.length>0?t._l(t.list,function(t){return n("group-item",{key:t.id,attrs:{group:t}})}):t._l(t.recommendList,function(t){return n("group-item",{key:t.id,attrs:{group:t}})})],2),n("p",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"load-more-ph m-text-c mt10"},[t._v("正在搜索...")]),t.noResult&&!t.loading&&t.keyword&&!t.list.length?["posts"===t.type?n("div",{staticClass:"no-groups"},[n("p",[t._v(" 未找到相关帖子～")]),n("button",{on:{click:function(e){t.$router.push({name:"groupCreatePost"})}}},[t._v("去发帖")])]):n("div",{staticClass:"no-groups"},[n("p",[t._v(" 未找到相关圈子, 创建属于自己的圈子吧")]),n("button",{on:{click:function(e){t.$router.push({name:"groupCreate"})}}},[t._v("创建圈子")])])]:t._e()],2)},r=[],o=n("8afe"),i=(n("386d"),n("96cf"),n("3040")),a=n("2ef0"),c=n.n(a),u=n("3d8d"),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("nav",{staticClass:"c-nav-tab"},[n("ul",t._l(t.nav,function(e,s){return n("router-link",{key:s,attrs:{to:{name:t.route.name,query:(r={},r[t.route.query]=s,r)},tag:"li",replace:""}},[t._v("\n      "+t._s(e)+"\n    ")]);var r}))])},d=[],h={name:"NavTab",props:{nav:{type:Object,required:!0},route:{type:Object,required:!0},default:{type:String,default:""}}},f=h,m=(n("611b"),n("2877")),p=Object(m["a"])(f,l,d,!1,null,"7b3899e5",null);p.options.__file="NavTab.vue";var g=p.exports,v=n("74f3"),b=n("265e"),_={name:"SearchPost",components:{SearchBar:u["a"],NavTab:g,GroupItem:v["a"],GroupFeedCard:b["a"]},data:function(){return{keywordOrigin:"",list:[],recommendList:[],loading:!1,noResult:!1,nav:{groups:"圈子",posts:"帖子"}}},computed:{type:function(){return this.$route.query.type||"groups"},keyword:function(){return this.keywordOrigin.trim()},groupId:function(){return this.$route.params.groupId}},watch:{keyword:function(){this.onSearchInput()},type:function(){this.list=[],this.onSearchInput()}},created:function(){this.$route.query.type||(this.$route.query.type="groups"),"groups"===this.type&&this.fetchRecommendGroups()},methods:{onSearchInput:c.a.debounce(Object(i["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.keyword){t.next=2;break}return t.abrupt("return");case 2:return this.loading=!0,t.next=5,this.search();case 5:e=t.sent,this.loading=!1,this.list=e,this.noResult=!this.list.length,this.$refs.loadmore.afterRefresh(e.length<15);case 10:case"end":return t.stop()}},t,this)})),600),onLoadMore:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.keyword){t.next=2;break}return t.abrupt("return");case 2:return this.loading=!0,t.next=5,this.search(this.list.length);case 5:e=t.sent,this.loading=!1,this.list=Object(o["a"])(this.list).concat(Object(o["a"])(e)),this.$refs.loadmore.afterLoadMore(e.length<15);case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),search:function(t){return"groups"===this.type?this.$store.dispatch("group/searchGroups",{keyword:this.keyword,offset:t}):this.$store.dispatch("group/searchPosts",{keyword:this.keyword,group_id:this.groupId,offset:t})},fetchRecommendGroups:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("group/getGroups",{type:"recommend"});case 2:e=t.sent,this.recommendList=e,this.$refs.loadmore.afterRefresh(!0);case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},y=_,k=(n("994c"),Object(m["a"])(y,s,r,!1,null,"15c88972",null));k.options.__file="GroupSearch.vue";e["default"]=k.exports},"67f2":function(t,e,n){"use strict";var s=n("c753"),r=n.n(s);r.a},6900:function(t,e,n){},"6e55":function(t,e,n){"use strict";var s=n("19ab"),r=n.n(s);r.a},"6f45":function(t,e,n){"use strict";var s=n("e83b"),r=n.n(s);r.a},"71d5":function(t,e,n){"use strict";var s=n("5b5d"),r=n.n(s);r.a},7312:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-group-members"},[n("search-bar",{staticClass:"search-bar",model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),n("h3",[t._v("选择新圈主")]),n("ul",t._l(t.searchList,function(e){return n("li",{key:e.id,on:{"!click":function(n){n.stopPropagation(),t.onChoose(e)}}},[n("group-user-item",{attrs:{member:e}})],1)}))],1)},r=[],o=(n("a481"),n("7f7f"),n("96cf"),n("3040")),i=(n("c5f6"),n("2ef0")),a=n.n(i),c=n("3d8d"),u=n("cb6f"),l={name:"GroupMembers",components:{SearchBar:c["a"],GroupUserItem:u["a"]},data:function(){return{keyword:"",searchList:[]}},computed:{currentUser:function(){return this.$store.state.CURRENTUSER},group:function(){return this.$store.state.group.current},groupId:function(){return Number(this.$route.params.groupId)}},watch:{keyword:function(t,e){if(""===t.trim())return this.searchList=[];t.trim()!==e.trim()&&this.searchUser(t)}},created:function(){this.group.id||this.fetchGroup(),this.searchUser()},methods:{fetchGroup:function(){this.$store.dispatch("group/getGroupById",{groupId:this.groupId})},searchUser:a.a.debounce(function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(e){var n,s=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.searchList=[],t.next=3,this.$store.dispatch("group/getMembers",{groupId:this.groupId,name:e,type:"audit_user",limit:100});case 3:n=t.sent,this.searchList=n.filter(function(t){return t.user_id!==s.currentUser.id});case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),600),onChoose:function(t){var e=this,n=[{text:"确定",method:function(){e.transferGroup(t.user_id)}}],s=this.group.name,r=t.user.name,o='确定将圈子"'.concat(s,'"转让给"').concat(r,'", 使其成为新的圈主?');this.$bus.$emit("actionSheet",n,"取消",o)},transferGroup:function(t){var e=this;this.$store.dispatch("group/transferGroup",{groupId:this.groupId,target:t}).then(function(t){e.$Message.success(t),e.$router.replace({name:"groupDetail",params:{groupId:e.group.id}})}).catch(function(t){var n=t.response.data;n&&e.$Message.error(n)})}}},d=l,h=(n("6e55"),n("2877")),f=Object(h["a"])(d,s,r,!1,null,"5aa5b9b2",null);f.options.__file="GroupTransfer.vue";e["default"]=f.exports},"739e":function(t,e,n){"use strict";var s=n("9214"),r=n.n(s);r.a},"748d":function(t,e,n){"use strict";var s=n("ef34"),r=n.n(s);r.a},"74f3":function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"c-group-item",on:{click:t.beforeViewDetail}},[n("div",{staticClass:"avatar"},[n("img",{attrs:{src:t.avatar}})]),n("div",{staticClass:"info"},[n("div",{staticClass:"m-box m-aln-center m-text-cut"},[n("h2",{staticClass:"m-text-cut"},[t._v(t._s(t.group.name))]),"paid"===t.mode?n("span",{staticClass:"paid"},[t._v("付费")]):t._e()]),n("p",[n("span",[t._v("帖子"),n("span",{staticClass:"number"},[t._v(t._s(t._f("formatNum")(t.feedCount)))])]),n("span",[t._v("成员"),n("span",{staticClass:"number"},[t._v(t._s(t._f("formatNum")(t.memberCount)))])])])]),t.isOwner?n("span",{staticClass:"owner-badge"},[t._v("圈主")]):t._e(),t.isAdmin?n("span",{staticClass:"admin-badge"},[t._v("管理员")]):t._e(),t.showAction?n("div",{staticClass:"action"},[t.joined&&0!==t.joined.audit?t._e():n("button",{staticClass:"m-text-cut",attrs:{disabled:t.loading||0===t.joined.audit},on:{click:function(e){return e.stopPropagation(),t.beforeJoined(e)}}},[0!==t.joined.audit?n("svg",{staticClass:"m-style-svg m-svg-def",style:t.loading?{}:{width:"0.2rem",height:"0.2rem"}},[n("use",{attrs:{"xlink:href":"#icon-"+(t.loading?"loading":"plus")}})]):t._e(),n("span",[t._v(t._s(0===t.joined.audit?"审核中":"加入"))])])]):t._e()])},r=[],o=(n("96cf"),n("3040")),i=n("6bde"),a=(n("7f7f"),n("c93e")),c=n("2f62"),u={name:"GroupItem",props:{group:{type:Object,required:!0},showAction:{type:Boolean,default:!0},showRole:{type:Boolean,default:!0}},data:function(){return{loading:!1}},computed:Object(a["a"])({},Object(c["d"])(["CURRENTUSER"]),{avatar:function(){var t=this.group.avatar||{};return t.url||null},name:function(){return this.group.name},feedCount:function(){return this.group.posts_count||0},memberCount:function(){return this.group.users_count||0},mode:function(){return this.group.mode},money:function(){return this.group.money||0},joined:function(){return this.group.joined||!1},role:function(){return"object"===Object(i["a"])(this.group.joined)&&this.joined.role},isOwner:function(){return"founder"===this.role},isAdmin:function(){return"administrator"===this.role},needPaid:function(){return"paid"===this.mode&&this.money>0}}),methods:{beforeJoined:function(){var t=this;this.joined||this.loading||(this.loading=!0,this.needPaid?this.$bus.$emit("payfor",{title:"申请加入圈子",confirmText:"支付并加入",amount:this.money,content:"你只需支付".concat(this.money).concat(this.currencyUnit,"来加入圈子"),checkPassword:!0,onOk:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.loading=!1,t.money<=t.CURRENTUSER.currency.sum?t.joinGroup(n):t.$router.push({name:"currencyRecharge"});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),onCancel:function(){t.loading=!1}}):this.joinGroup())},joinGroup:function(t){var e=this;this.$store.dispatch("group/joinGroup",{groupId:this.group.id,needPaid:this.needPaid,password:t}).then(function(t){e.loading=!1,e.$Message.success(t),e.group.joined=e.needPaid?{}:{audit:1}}).catch(function(t){e.loading=!1,e.$Message.error(t.response.data)})},beforeViewDetail:function(){this.joined?1===this.joined.audit?this.$router.push("/groups/".concat(this.group.id)):this.$Message.error("审核通过后，才能查看圈子信息哦~"):"public"!==this.mode?this.$Message.error("需要先加入圈子，才能查看圈子信息哦~"):this.$router.push("/groups/".concat(this.group.id))}}},l=u,d=(n("7a08"),n("2877")),h=Object(d["a"])(l,s,r,!1,null,"23369a83",null);h.options.__file="GroupItem.vue";e["a"]=h.exports},"790c":function(t,e,n){},"7a08":function(t,e,n){"use strict";var s=n("85c2"),r=n.n(s);r.a},"7f18":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-group-list"},[n("common-header",{staticClass:"common-header"},[t._v("\n    全部圈子\n    "),n("template",{slot:"right"},[n("svg",{staticClass:"m-style-svg m-svg-def",on:{click:function(e){t.$router.push({name:"groupSearch"})}}},[n("use",{attrs:{"xlink:href":"#icon-search"}})]),n("svg",{staticClass:"m-style-svg m-svg-def",on:{click:function(e){t.$router.push({name:"groupCreate"})}}},[n("use",{attrs:{"xlink:href":"#icon-group-create"}})])])],2),n("nav",{staticClass:"groups-nav"},[n("router-link",{staticClass:"item",attrs:{to:{name:"groups",query:{type:"recommend"}},exact:"",replace:"",tag:"div","active-class":"active"}},[n("span",[t._v("推荐")])]),t._l(t.categories,function(e){return n("router-link",{key:e.id,staticClass:"item",attrs:{to:{name:"groups",query:{category:e.id}},exact:"",replace:"",tag:"div","active-class":"active"}},[n("span",{staticClass:"m-text-cut"},[t._v(t._s(e.name))])])})],2),n("main",[n("jo-load-more",{ref:"loadmore",attrs:{"auto-load":!1},on:{onRefresh:t.onRefresh,onLoadMore:t.onLoadMore}},t._l(t.groups,function(t){return n("div",{key:t.id,staticClass:"group-item-wrap"},[n("group-item",{attrs:{group:t,"show-action":!0}})],1)}))],1)],1)},r=[],o=(n("96cf"),n("3040")),i=(n("f751"),n("a481"),n("1c4c"),n("ac6a"),n("f400"),n("74f3")),a={name:"GroupList",components:{GroupItem:i["a"]},data:function(){return{GROUPS:new Map,GROUPChangeTracker:1}},computed:{categories:function(){return this.$store.state.group.categories},recommend:{get:function(){return this.$route.query.type||!1},set:function(t){this.$route.query.type=t?"recommend":""}},category:function(){return this.$route.query.category},currentUserID:function(){return this.$store.state.CURRENTUSER.id},currentType:function(){return this.recommend?-1:this.category},groups:function(){return this.currentType&&this.GROUPChangeTracker&&this.GROUPS.has(this.currentType)?Array.from(this.GROUPS.get(this.currentType).values()):[]}},watch:{currentType:function(t){t&&this.$refs.loadmore.beforeRefresh()}},created:function(){this.$route.query.type||this.$route.query.category||this.$router.replace(Object.assign({},this.$route,{query:{type:"recommend"}})),this.$store.dispatch("group/getGroupTypes")},mounted:function(){this.$refs.loadmore.beforeRefresh()},methods:{formateGroups:function(t){var e=this.GROUPS.has(this.currentType)?this.GROUPS.get(this.currentType):new Map;t.forEach(function(t){e.set(t.id,t)}),this.GROUPS.set(this.currentType,e),this.GROUPChangeTracker+=1},switchCate:function(t){this.recommend=!1,this.$route.query.category=t.id},onRefresh:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e={},this.recommend?e.type="recommend":e.categoryId=this.category,t.next=4,this.$store.dispatch("group/getGroups",e);case 4:n=t.sent,this.formateGroups(n),this.$refs.loadmore.afterRefresh(n.length<15);case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),onLoadMore:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e={offset:this.groups.length},this.recommend?e.type="recommend":e.categoryId=this.category,t.next=4,this.$store.dispatch("group/getGroups",e);case 4:n=t.sent,this.formateGroups(n),this.$refs.loadmore.afterLoadMore(n.length<15);case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},c=a,u=(n("71d5"),n("2877")),l=Object(u["a"])(c,s,r,!1,null,"6f8d03ef",null);l.options.__file="GroupList.vue";e["default"]=l.exports},8270:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"m-art-rewards"},[n("common-header",[t._v("打赏列表")]),n("main",[n("jo-load-more",{ref:"loadmore",attrs:{"auto-load":!1},on:{onRefresh:t.onRefresh,onLoadMore:t.onLoadMore}},t._l(t.rewards,function(e,s){var r=e.user,o=e.id,i=e.created_at;return n("section",{key:"reward-"+o+"-"+s,staticClass:"m-box m-aln-center m-justify-bet m-art-reward-item m-bb1 m-main"},[n("avatar",{attrs:{user:r,size:"tiny"}}),n("h2",{staticClass:"m-box m-flex-grow1 m-flex-shrink1 m-text-cut"},[n("b",[t._v(t._s(r.name))]),t._v("打赏了"+t._s(t.typeMap[t.type]))]),n("time",{staticClass:"m-flex-grow0 m-flex-shrink0",attrs:{datetime:i}},[t._v(t._s(t._f("time2tips")(i)))])],1)}))],1)],1)},r=[],o=n("8afe"),i={name:"ArticleRewards",data:function(){return{rewards:[],typeMap:{feed:"动态",news:"资讯",post:"帖子",answer:"回答"}}},computed:{type:function(){return this.$route.meta.type},article:function(){return this.$route.params.article},url:function(){switch(this.type){case"feed":return"/feeds/".concat(this.article,"/rewards");case"news":return"/news/".concat(this.article,"/rewards");case"post":return"/plus-group/group-posts/".concat(this.article,"/rewards");case"answer":return"/question-answers/".concat(this.article,"/rewarders")}}},mounted:function(){this.$refs.loadmore.beforeRefresh()},methods:{onRefresh:function(t){var e=this;this.$http.get(this.url,{params:{limit:15}}).then(function(n){var s=n.data,r=void 0===s?[]:s;e.rewards=r,t(r.length<15)}).catch(function(){t(!0)})},onLoadMore:function(t){var e=this;this.$http.get(this.url,{params:{limit:15,offset:this.rewards.length}}).then(function(n){var s=n.data,r=void 0===s?[]:s;e.rewards=Object(o["a"])(e.rewards).concat(Object(o["a"])(r)),t(r.length<15)}).catch(function(){t(!0)})}}},a=i,c=(n("4551"),n("2877")),u=Object(c["a"])(a,s,r,!1,null,"123d7b16",null);u.options.__file="ArticleRewards.vue";e["default"]=u.exports},"82c2":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"m-art-likes"},[n("common-header",[t._v("点赞列表")]),n("main",[n("jo-load-more",{ref:"loadmore",attrs:{"auto-load":!1},on:{onRefresh:t.onRefresh,onLoadMore:t.onLoadMore}},t._l(t.likes,function(t,e){var s=t.user,r=t.id;return n("user-item",{key:"likes-"+r+"-"+s.id+"-"+e,attrs:{user:s}})}))],1)],1)},r=[],o=n("8afe"),i=n("86e8"),a={name:"ArticleLikes",components:{UserItem:i["a"]},data:function(){return{likes:[],maxId:0}},computed:{type:function(){return this.$route.meta.type},article:function(){return this.$route.params.article},url:function(){switch(this.type){case"feed":return"/feeds/".concat(this.article,"/likes");case"news":return"/news/".concat(this.article,"/likes");case"post":return"/plus-group/group-posts/".concat(this.article,"/likes");case"answer":return"/question-answers/".concat(this.article,"/likes")}}},mounted:function(){this.$refs.loadmore.beforeRefresh()},methods:{goBack:function(){window.history.length<=1?this.$router.push("/feeds/".concat(this.article)):this.$router.go(-1)},onRefresh:function(t){var e=this;this.$http.get(this.url,{params:{limit:15}}).then(function(n){var s=n.data,r=void 0===s?[]:s;e.likes=r,r.length>0&&(e.maxId=r[r.length-1].id),t(r.length<15)})},onLoadMore:function(t){var e=this;this.$http.get(this.url,{params:{limit:15,after:this.maxId}}).then(function(n){var s=n.data,r=void 0===s?[]:s;e.likes=Object(o["a"])(e.likes).concat(Object(o["a"])(r)),r.length>0&&(e.maxId=r[r.length-1].id),t(r.length<15)})}}},c=a,u=n("2877"),l=Object(u["a"])(c,s,r,!1,null,null,null);l.options.__file="ArticleLikes.vue";e["default"]=l.exports},"85c2":function(t,e,n){},"877f":function(t,e,n){"use strict";var s=n("dcb0"),r=n.n(s);r.a},"8fd6":function(t,e,n){},9214:function(t,e,n){},"97f1":function(t,e,n){"use strict";var s=n("f170"),r=n.n(s);r.a},"994c":function(t,e,n){"use strict";var s=n("aa98"),r=n.n(s);r.a},"9e56":function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.list.length?n("div",{staticClass:"c-detail-ad"},t._l(t.list,function(t){return n("a",{key:t.id,staticClass:"item",attrs:{href:t.data.link}},[n("div",{staticClass:"img",style:{"background-image":"url("+t.data.image+")"}})])})):t._e()},r=[],o=(n("55dd"),n("ac6a"),n("456d"),n("6762"),n("2fdb"),n("1647")),i={feed:"feed:single",news:"news:single","group:home":"group:index:top","group:post":"group:single",currency:"currency"},a={name:"DetailAd",props:{type:{type:String,required:!0,validator:function(t){return Object.keys(i).includes(t)}}},data:function(){return{list:[]}},computed:{adTypeId:function(){var t=this.$store.getters.getAdTypeBySpace(i[this.type]);return t.id}},mounted:function(){this.fetchList()},methods:{fetchList:function(){var t=this;o["a"](this.adTypeId).then(function(e){var n=e.data;t.list=n.sort(function(t,e){return t.sort<e.sort})})}}},c=a,u=(n("6f45"),n("2877")),l=Object(u["a"])(c,s,r,!1,null,"5553e1aa",null);l.options.__file="DetailAd.vue";e["a"]=l.exports},"9ff4":function(t,e,n){"use strict";var s=n("2251"),r=n.n(s);r.a},a46e:function(t,e,n){"use strict";var s=n("1f1e"),r=n.n(s);r.a},a52a:function(t,e,n){},aa98:function(t,e,n){},ae61:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"m-lim-width m-art-comment"},[n("div",{staticClass:"m-box m-art-comment-wrap"},[n("avatar",{attrs:{user:t.user}}),n("section",{staticClass:"m-box-model m-flex-grow1 m-flex-shrink1 m-art-comment-body"},[n("header",{staticClass:"m-box m-aln-center m-justify-bet m-art-comment-usr"},[n("h4",{staticClass:"m-flex-grow1 m-flex-shrink1"},[t._v(t._s(t.user.name))]),n("div",{staticClass:"m-box m-aln-center"},[t.pinned?n("span",{staticClass:"m-art-comment-icon-top"},[t._v("置顶")]):t._e(),n("span",[t._v(t._s(t._f("time2tips")(t.time)))])])]),n("article",{staticClass:"m-text-box m-art-comment-con",class:{maxh:!t.isShowAll},on:{click:t.handelClick}},[t.replyUser?[n("span",{staticClass:"m-art-comment-rep"},[t._v("\n            回复"),n("router-link",{attrs:{to:"/users/"+t.replyUser.id}},[t._v(t._s(t.replyUser.name))]),t._v("：\n          ")],1)]:t._e(),t._v("\n        "+t._s(t.body)+"\n        "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.bodyLength>60&&!t.isShowAll,expression:"bodyLength > 60 && !isShowAll"}],staticClass:"m-text-more",on:{click:function(e){e.stopPropagation(),t.isShowAll=!t.isShowAll}}},[t._v(" >>更多")])],2)])],1)])},r=[];n("7f7f");function o(t){for(var e,n=0,s=0;s<t.length;s++)e=t.charCodeAt(s),e<127?n+=.25:e>=128&&e<=2047?n+=1:e>=2048&&e<=65535&&(n+=1.5);return n}var i={name:"CommentItem",props:{comment:{type:Object,required:!0},pinned:{type:Boolean,default:!1}},data:function(){return{showAll:!1}},computed:{isShowAll:{get:function(){return this.bodyLength<60||this.showAll},set:function(t){this.showAll=t}},user:function(){var t=this.comment.user;return t&&t.id?t:{}},replyUser:function(){var t=this.comment.reply;return t&&t.id?t:null},body:function(){return this.comment.body||""},bodyLength:function(){return o(this.body)},time:function(){return this.comment.created_at||""}},mounted:function(){this.$store.commit("SAVE_USER",this.user)},methods:{handelClick:function(){if(!this.isShowAll)return this.isShowAll=!this.isShowAll;this.$emit("click",this.user.id,this.user.name,this.comment.id)}}},a=i,c=n("2877"),u=Object(c["a"])(a,s,r,!1,null,null,null);u.options.__file="ArticleComment.vue";e["a"]=u.exports},b426:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("article-card",{attrs:{liked:t.liked,loading:t.loading},on:{"on-like":t.likeFeed,"on-share":t.shareFeed,"on-more":t.moreAction,"on-comment":t.commentFeed}},[n("common-header",{attrs:{slot:"head"},slot:"head"},[n("avatar",{attrs:{user:t.user,size:"tiny"}}),n("span",{staticClass:"m-text-cut m-flex-none username"},[t._v("\n      "+t._s(t.user.name)+"\n    ")]),t.isMine?t._e():n("template",{class:{c_59b6d7:"unFollow"!==t.relation.status},slot:"right"},[n("svg",{staticClass:"m-style-svg m-svg-def",on:{click:function(e){t.followUserByStatus(t.relation.status)}}},[n("use",{attrs:{"xlink:href":t.relation.icon}})])])],2),n("jo-load-more",{ref:"loadmore",on:{onRefresh:t.fetchFeed}},[n("main",{staticClass:"m-flex-shrink1 m-flex-grow1 m-art m-main"},[n("div",{staticClass:"m-art-body"},[t.title?n("h2",{staticClass:"post-title"},[t._v(t._s(t.title))]):t._e(),t.video?n("video",{staticClass:"feed-detail-video",attrs:{poster:t.cover_file,controls:"",autoplay:""}},[n("source",{attrs:{src:t.video_file,type:"video/mp4"}})]):t._e(),t._l(t.images,function(e){return e.file?n("async-file",{key:e.file,attrs:{file:e.file},scopedSlots:t._u([{key:"default",fn:function(s){return s.src?n("img",{attrs:{src:s.src},on:{click:function(n){t.onFileClick(e)}}}):t._e()}}])}):t._e()}),n("p",{staticClass:"m-text-box markdown-body",domProps:{innerHTML:t._s(t.formatBody(t.feedContent))}})],2),n("div",{staticClass:"m-box m-aln-center m-justify-bet m-art-foot"},[n("div",{staticClass:"m-flex-grow1 m-flex-shrink1 m-art-like-list"},[t.likeCount>0?n("router-link",{staticClass:"m-box m-aln-center",attrs:{tag:"div",to:"likers",append:""}},[n("ul",{staticClass:"m-box m-flex-grow0 m-flex-shrink0"},t._l(t.likes.slice(0,5),function(e,s){var r=e.user;void 0===r&&(r={});var o=e.id;return n("li",{key:o,staticClass:"m-avatar-box tiny",class:"m-avatar-box-"+r.sex,style:{zIndex:5-s}},[n("img",{attrs:{src:t.getAvatar(r.avatar)}})])})),n("span",[t._v(t._s(t._f("formatNum")(t.likeCount))+"人点赞")])]):t._e()],1),n("div",{staticClass:"m-box-model m-aln-end m-art-info"},[t.time?n("span",[t._v("发布于"+t._s(t._f("time2tips")(t.time)))]):t._e(),n("span",[t._v(t._s(t._f("formatNum")(t.feed.views_count||0))+"浏览")])])]),n("div",{staticClass:"m-box-model m-box-center m-box-center-a m-art-reward"},[n("button",{staticClass:"m-art-rew-btn",on:{click:t.rewardFeed}},[t._v("打 赏")]),n("p",{staticClass:"m-art-rew-label"},[n("a",{attrs:{href:"javascript:;"}},[t._v(t._s(t._f("formatNum")(t.reward.count)))]),t._v("人打赏，共"),n("a",{attrs:{href:"javascript:;"}},[t._v(t._s(~~t.reward.amount))]),t._v(t._s(t.currencyUnit))]),n("router-link",{staticClass:"m-box m-aln-center m-art-rew-list",attrs:{tag:"ul",to:"rewarders",append:""}},[t._l(t.rewardList,function(e){return n("li",{key:e.id,staticClass:"m-flex-grow0 m-flex-shrink0 m-art-rew m-avatar-box tiny",class:"m-avatar-box-"+e.user.sex},[n("img",{attrs:{src:t.getAvatar(e.user.avatar)}})])}),t.rewardList.length>0?n("li",{staticClass:"m-box m-aln-center"},[n("svg",{staticClass:"m-style-svg m-svg-def",staticStyle:{fill:"#bfbfbf"}},[n("use",{attrs:{"xlink:href":"#icon-arrow-right"}})])]):t._e()],2)],1)]),n("detail-ad",{attrs:{type:"group:post"}}),n("div",{staticClass:"m-box-model m-art-comments",attrs:{id:"comment_list"}},[n("ul",{staticClass:"m-box m-aln-center m-art-comments-tabs"},[n("li",[t._v(t._s(t._f("formatNum")(t.commentCount))+"条评论")])]),t._l(t.pinnedCom,function(e){return n("comment-item",{key:"pinned-comment-"+e.id,attrs:{pinned:!0,comment:e},on:{click:t.replyComment}})}),t._l(t.comments,function(e){return n("comment-item",{key:e.id,attrs:{comment:e},on:{click:t.replyComment}})}),n("div",{staticClass:"m-box m-aln-center m-justify-center load-more-box"},[t.noMoreCom?n("span",{staticClass:"load-more-ph"},[t._v("---没有更多---")]):n("span",{staticClass:"load-more-btn",on:{click:function(e){e.stopPropagation(),t.fetchFeedComments(t.maxComId)}}},[t._v("\n          "+t._s(t.fetchComing?"加载中...":"点击加载更多")+"\n        ")])])],2)],1)],1)},r=[],o=(n("c5f6"),n("8afe")),i=(n("7f7f"),n("c93e")),a=(n("6762"),n("2fdb"),n("d4cd")),c=n.n(a),u=n("2ae9"),l=n.n(u),d=n("2988"),h=n("9e56"),f=n("1238"),m=n("c24f"),p=n("365c"),g=n("23ba"),v={name:"GroupPostDetail",components:{DetailAd:h["a"]},mixins:[d["default"]],data:function(){return{feed:{likes:[]}}},computed:{video_file:function(){return!1},cover_file:function(){return!1},postId:function(){return this.$route.params.postId},groupId:function(){return this.$route.params.groupId},group:function(){return this.feed.group||{}},likes:function(){return this.feed.likes||[]},liked:{get:function(){return!!this.feed.liked},set:function(t){this.feed.liked=t}},likeCount:{get:function(){return this.feed.likes_count||0},set:function(t){this.feed.likes_count=~~t}},commentCount:{get:function(){return this.feed.comments_count||0},set:function(t){t>0&&(this.feed.comments_count=t)}},images:function(){return this.feed.images||[]},firstImage:function(){var t=this.images;if(!t.length)return"";var e=t[0]||{};return this.$http.defaults.baseURL+"/files/"+e.id+"?w=300&h=300"},feedContent:function(){var t=this.feed.body,e=void 0===t?"":t;return e},reward:function(){return{amount:this.feed.reward_amount,count:this.feed.reward_number}||{}},has_collect:{get:function(){return this.feed.collected},set:function(t){this.feed.collected=t}},isGroupManager:function(){var t=this.group.joined||{},e=t.role,n=void 0===e?"":e;return["founder","administrator"].includes(n)},relation:{get:function(){var t={unFollow:{text:"关注",status:"unFollow",icon:"#icon-unFollow"},follow:{text:"已关注",status:"follow",icon:"#icon-follow"},eachFollow:{text:"互相关注",status:"eachFollow",icon:"#icon-eachFollow"}},e=this.user,n=e.follower,s=e.following;return t[n&&s?"eachFollow":n?"follow":"unFollow"]},set:function(t){this.user.follower=t}}},created:function(){this.fetchFeed()},activated:function(){var t=this;this.postId&&(this.postId!==this.oldID?(this.components=[],this.fetchFeed()):setTimeout(function(){t.loading=!1},200))},methods:{handleCollection:function(){var t=this;g["e"](this.feed.id,this.has_collect).then(function(){t.$Message.success("操作成功"),t.has_collect=!t.has_collect})},formatBody:function(t){return c()({html:!0}).use(l.a,"".concat(this.$http.defaults.baseURL,"/files/")).render(t)},fetchFeed:function(){var t=this;if(!this.fetching){this.fetching=!0;var e=window.location.origin+"/hanfu360/".substr(0,"/hanfu360/".length-1)+this.$route.fullPath,n="IOS"===this.$store.state.BROWSER.OS?window.initUrl:e;this.$store.dispatch("group/getPostDetail",{groupId:this.groupId,postId:this.postId}).then(function(s){t.feed=Object(i["a"])({},s),t.user=t.feed.user,t.oldID=t.postId,t.fetching=!1,t.fetchFeedComments(),t.fetchRewards(),t.fetchLikes(),t.isWechat&&Object(f["a"])(n,{title:"".concat(s.user.name,"的动态"),desc:"".concat(s.feed_content),link:e,imgUrl:s.images.length>0?"".concat(t.$http.defaults.baseURL,"/files/").concat(s.images[0].file):""}),t.$refs.loadmore.afterRefresh()}).catch(function(){t.goBack()})}},fetchRewards:function(){var t=this;this.$http.get("/plus-group/group-posts/".concat(this.postId,"/rewards"),{params:{limit:10}}).then(function(e){var n=e.data,s=void 0===n?[]:n;t.rewardList=s})},fetchFeedComments:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fetchComing||(this.fetchComing=!0,g["v"](this.postId,{after:e}).then(function(n){var s=n.data,r=s.pinneds,i=void 0===r?[]:r,a=s.comments,c=void 0===a?[]:a;if(e)t.comments=Object(o["a"])(t.comments).concat(Object(o["a"])(c));else{t.pinnedCom=i;var u=i.map(function(t){return t.id});t.comments=c.filter(function(t){return u.indexOf(t.id)<0})}c.length&&(t.maxComId=c[c.length-1].id),t.noMoreCom=c.length!==p["b"],t.$nextTick(function(){t.loading=!1,t.fetchComing=!1})}).catch(function(){t.loading=!1,t.fetchComing=!1}))},fetchLikes:function(){var t=this;this.$http.get("/plus-group/group-posts/".concat(this.postId,"/likes"),{params:{limit:8}},{validateStatus:function(t){return 200===t}}).then(function(e){var n=e.data,s=void 0===n?[]:n;t.feed=Object(i["a"])({},t.feed,{likes:s})})},likeFeed:function(){var t=this;g["A"](this.postId,this.liked).then(function(){t.liked?(t.liked=!1,t.likeCount-=1,t.feed.likes=t.feed.likes.filter(function(e){return e.user_id!==t.CURRENTUSER.id})):(t.liked=!0,t.likeCount+=1,t.feed.likes.length<5&&(t.feed.likes=Object(o["a"])(t.feed.likes).concat([{user:t.CURRENTUSER,id:(new Date).getTime(),user_id:t.CURRENTUSER.id}]))),t.fetching=!1}).catch(function(){t.fetching=!1})},moreAction:function(){var t=this,e=[];this.has_collect?e.push({text:"取消收藏",method:function(){g["J"](t.postId).then(function(){t.$Message.success("取消收藏"),t.has_collect=!1})}}):e.push({text:"收藏",method:function(){g["f"](t.postId).then(function(){t.$Message.success("已加入我的收藏"),t.has_collect=!0})}}),this.isGroupManager?this.feed.pinned?e.push({text:"撤销置顶",method:function(){var e=[{text:"撤销置顶",method:function(){t.$store.dispatch("group/unpinnedPost",{postId:t.feed.id}).then(function(){t.$Message.success("撤销置顶成功！"),t.fetchFeed()})}}];setTimeout(function(){t.$bus.$emit("actionSheet",e,"取消","确认撤销置顶?")},200)}}):e.push({text:"置顶帖子",method:function(){t.$bus.$emit("applyTop",{type:"post-manager",api:g["C"],payload:t.feed.id,callback:function(){t.$Message.success("置顶成功！"),t.fetchFeed()}})}}):this.isMine&&!this.feed.pinned&&e.push({text:"申请帖子置顶",method:function(){t.$bus.$emit("applyTop",{type:"post",api:g["b"],payload:t.postId})}}),(this.isMine||this.isGroupManager)&&e.push({text:"删除帖子",method:function(){setTimeout(function(){var e=[{text:"删除",style:{color:"#f4504d"},method:function(){t.$store.dispatch("group/deletePost",{groupId:t.groupId,postId:t.postId}).then(function(){t.$Message.success("删除帖子成功"),t.goBack()})}}];t.$bus.$emit("actionSheet",e,"取消","确认删除?")},200)}}),this.$bus.$emit("actionSheet",e,"取消")},followUserByStatus:function(t){var e=this;t&&!this.fetchFollow&&(this.fetchFollow=!0,Object(m["d"])({id:this.user.id,status:t}).then(function(t){e.relation=t,e.fetchFollow=!1}))},replyComment:function(t,e,n){var s=this;if(t===this.CURRENTUSER.id){var r=t===this.user.id,o=[{text:r?"评论置顶":"申请评论置顶",method:function(){s.$bus.$emit("applyTop",{isOwner:r,type:"postComment",api:g["c"],payload:{postId:Number(s.postId),commentId:n},callback:s.fetchFeedComments})}},{text:"删除评论",method:function(){return s.deleteComment(n)}}];this.$bus.$emit("actionSheet",o,"取消")}else this.$bus.$emit("commentInput",{placeholder:"回复： ".concat(e),onOk:function(e){s.sendComment({reply_user:t,body:e})}})},sendComment:function(t){var e=this,n=t.reply_user,s=t.body,r={};s&&s.length>0?(r.body=s,n&&(r["reply_user"]=n),this.$http.post("/plus-group/group-posts/".concat(this.postId,"/comments"),r,{validateStatus:function(t){return 201===t}}).then(function(t){var n=t.data;n=void 0===n?{comment:{}}:n;var s=n.comment;e.$Message.success("评论成功"),e.comments.unshift(s),e.$bus.$emit("commentInput:close",!0)}).catch(function(){e.$Message.error("评论失败"),e.$bus.$emit("commentInput:close",!0)})):this.$Message.error("评论内容不能为空")},rewardFeed:function(){var t=this,e=function(e){t.fetchRewards(),t.feed.reward_number+=1,t.feed.reward_amount+=e};this.$bus.$emit("reward",{type:"groupPost",api:g["F"],payload:this.postId,callback:e})},deleteComment:function(t){var e=this;this.$store.dispatch("group/deletePostComment",{postId:this.postId,commentId:t}).then(function(){e.fetchFeedComments(),e.commentCount-=1,e.$Message.success("删除评论成功")})},getAvatar:function(t){return t=t||{},t.url||null}}},b=v,_=(n("748d"),n("2877")),y=Object(_["a"])(b,s,r,!1,null,"21f980ae",null);y.options.__file="GroupPostDetail.vue";e["default"]=y.exports},ba6b:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",[n("router-view")],1)},r=[],o={name:"GroupDetailBase"},i=o,a=n("2877"),c=Object(a["a"])(i,s,r,!1,null,null,null);c.options.__file="GroupDetailBase.vue";e["default"]=c.exports},c38d:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-group-create"},[n("common-header",[t._v("创建圈子\n    "),n("span",{staticClass:"m-send-btn",attrs:{slot:"left"},on:{click:t.goBack},slot:"left"},[t._v("取消")]),n("template",{slot:"right"},[t.loading?n("circle-loading"):n("a",{staticClass:"m-send-btn",class:{disabled:t.disabled},on:{click:function(e){return e.preventDefault(),t.handleOk(e)}}},[t._v("创建")])],1)],2),n("form",[n("form-avatar-item",{attrs:{label:"上传圈子头像",shape:"square",type:"blob"},model:{value:t.avatar,callback:function(e){t.avatar=e},expression:"avatar"}}),n("form-input-item",{attrs:{label:"圈名",maxlength:"20",placeholder:"输入圈名, 20字以内"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}}),n("form-select-item",{attrs:{label:"分类",placeholder:"选择圈子类别"},on:{click:t.switchCate},model:{value:t.category.name,callback:function(e){t.$set(t.category,"name",e)},expression:"category.name"}}),n("form-tags-item",{model:{value:t.tags,callback:function(e){t.tags=e},expression:"tags"}}),n("form-location-item",{model:{value:t.location,callback:function(e){t.location=e},expression:"location"}}),n("form-input-item",{attrs:{type:"textarea",label:"简介",maxlength:"255",warnlength:"200",placeholder:"编辑简介"},model:{value:t.form.summary,callback:function(e){t.$set(t.form,"summary",e)},expression:"form.summary"}}),n("hr"),n("form-switch-item",{attrs:{label:"帖子同步至动态"},model:{value:t.allowFeed,callback:function(e){t.allowFeed=e},expression:"allowFeed"}}),n("form-switch-item",{attrs:{label:"设置为封闭圈子"},model:{value:t.privateMode,callback:function(e){t.privateMode=e},expression:"privateMode"}}),t.privateMode?[n("section",{staticClass:"c-form-item bb"},[n("label",{staticClass:"check-label",on:{click:function(e){t.needPaid=!0}}},[n("input",{attrs:{type:"checkbox"},domProps:{value:t.needPaid}}),n("span",{staticClass:"checkmark"}),n("span",[t._v("收费入圈")])]),n("label",{staticClass:"label-amount"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.form.money,expression:"form.money"}],attrs:{type:"text",placeholder:"设置收费入圈金额",maxlength:"8"},domProps:{value:t.form.money},on:{input:function(e){e.target.composing||t.$set(t.form,"money",e.target.value)}}}),n("span",[t._v(t._s(t.currencyUnit))])])]),n("section",{staticClass:"c-form-item bb"},[n("label",{staticClass:"check-label",on:{click:function(e){t.needPaid=!1}}},[n("input",{attrs:{type:"checkbox"},domProps:{value:!t.needPaid}}),n("span",{staticClass:"checkmark"}),n("span",[t._v("免费入圈")])])])]:t._e(),n("p",{staticClass:"footage"},[t._v("注：用户需经圈管理员同意方可加入封闭圈子")]),n("form-input-item",{attrs:{type:"textarea",label:"公告",placeholder:"选填",maxlength:"2000",warnlength:"200"},model:{value:t.form.notice,callback:function(e){t.$set(t.form,"notice",e)},expression:"form.notice"}}),n("p",{staticClass:"footage"},[t._v("点击创建即代表同意"),n("a",{attrs:{href:"javascript:;"},on:{click:t.showProtocol}},[t._v("《ThinkSNS+圈子创建协议》")])])],2),n("choose-group-cate",{ref:"chooseGroupCate",on:{change:t.onGroupCateChange}}),n("group-protocol",{ref:"protocol"})],1)},r=[],o=(n("ac4d"),n("8a81"),n("ac6a"),n("96cf"),n("3040")),i=(n("4917"),n("7f7f"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"fade"}},[t.showPage?n("div",{staticClass:"m-box-model m-pos-f p-choose-category m-main"},[n("common-header",{attrs:{back:t.cancel}},[t._v(" "+t._s(t.title||"圈子分类")+" ")]),n("main",[n("ul",{staticClass:"m-cates"},t._l(t.categories,function(e){return e.id?n("li",{key:e.id,staticClass:"m-cate",on:{click:function(n){t.selected(e)}}},[n("span",[t._v(t._s(e.name))])]):t._e()}))])],1):t._e()])}),a=[],c={name:"ChooseGroupCate",data:function(){return{showPage:!1,title:""}},computed:{categories:function(){return this.$store.state.group.categories}},mounted:function(){this.$store.dispatch("group/getGroupTypes")},methods:{show:function(){this.showPage=!0,this.scrollable=!1},selected:function(t){this.$emit("change",t),this.cancel()},cancel:function(){this.showPage=!1,this.scrollable=!0}}},u=c,l=(n("174f"),n("2877")),d=Object(l["a"])(u,i,a,!1,null,"3de70d82",null);d.options.__file="chooseGroupCate.vue";var h=d.exports,f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"pop"}},[t.visible?n("div",{staticClass:"p-group-protocol"},[n("common-header",{attrs:{back:t.close}},[t._v("圈子创建协议")]),n("main",{staticClass:"m-art-body markdown-body",domProps:{innerHTML:t._s(t.body)}})],1):t._e()])},m=[],p=n("c93e"),g=n("2f62"),v=n("1038"),b={name:"GroupProtocol",data:function(){return{visible:!1}},computed:Object(p["a"])({},Object(g["d"])("group",["protocol"]),{body:function(){return Object(v["default"])(this.protocol||"")}}),created:function(){this.$store.dispatch("group/getProtocol")},methods:{show:function(){this.visible=!0},close:function(){this.visible=!1}}},_=b,y=(n("3bc7"),Object(l["a"])(_,f,m,!1,null,null,null));y.options.__file="GroupProtocol.vue";var k=y.exports,C=[16,8,4,2,1],w="0123456789bcdefghjkmnpqrstuvwxyz",x={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}},$={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};function I(t,e){var n,s=1,r=[],o=[],i=0,a=0,c=12,u="";r[0]=-90,r[1]=90,o[0]=-180,o[1]=180;while(u.length<c)s?(n=(o[0]+o[1])/2,e>n?(a|=C[i],o[0]=n):o[1]=n):(n=(r[0]+r[1])/2,t>n?(a|=C[i],r[0]=n):r[1]=n),s=!s,i<4?i++:(u+=w[a],i=0,a=0);return u}x.bottom.odd=x.left.even,x.top.odd=x.right.even,x.left.odd=x.bottom.even,x.right.odd=x.top.even,$.bottom.odd=$.left.even,$.top.odd=$.right.even,$.left.odd=$.bottom.even,$.right.odd=$.top.even;var R={name:"GroupCreate",components:{ChooseGroupCate:h,GroupProtocol:k},data:function(){return{loading:!1,needPaid:!1,category:{},tags:[],location:{label:"设置圈子的地理位置"},avatar:null,privateMode:!1,form:{name:"",summary:"",allow_feed:0,mode:"public",money:"",notice:""}}},computed:{disabled:function(){return!(this.avatar&&this.form.name&&this.tags.length&&this.form.mode)||"paid"===this.form.mode&&!this.form.money.match(/^\d{1,8}$/)},allowFeed:{get:function(){return!!this.form.allow_feed},set:function(t){this.form.allow_feed=t?1:0}}},watch:{privateMode:function(t){this.form.mode=t?this.needPaid?"paid":"private":"public"},needPaid:function(t){t?this.form.mode="paid":(this.form.mode="private",this.form.money=null)},"form.money":function(t){t&&(this.needPaid=!0)}},methods:{showProtocol:function(){this.$refs.protocol.show()},switchCate:function(){this.$refs.chooseGroupCate.show()},onGroupCateChange:function(t){this.category=t},handleOk:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,n,s,r,o,i,a,c,u,l,d;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.loading){t.next=2;break}return t.abrupt("return");case 2:this.loading=!0,e=new FormData,t.t0=regeneratorRuntime.keys(this.form);case 5:if((t.t1=t.t0()).done){t.next=12;break}if(n=t.t1.value,this.form[n]){t.next=9;break}return t.abrupt("continue",5);case 9:e.append(n,this.form[n]),t.next=5;break;case 12:for(s=!0,r=!1,o=void 0,t.prev=15,i=this.tags[Symbol.iterator]();!(s=(a=i.next()).done);s=!0)c=a.value,e.append("tags[][id]",c.id);t.next=23;break;case 19:t.prev=19,t.t2=t["catch"](15),r=!0,o=t.t2;case 23:t.prev=23,t.prev=24,s||null==i.return||i.return();case 26:if(t.prev=26,!r){t.next=29;break}throw o;case 29:return t.finish(26);case 30:return t.finish(23);case 31:return this.location.label&&(u=I(this.location.lat,this.location.lng),e.append("location",this.location.label),e.append("latitude",this.location.lat),e.append("longitude",this.location.lng),e.append("geo_hash",u)),e.append("avatar",this.avatar),l={category:this.category.id,formData:e},t.next=36,this.$store.dispatch("group/createGroup",l);case 36:d=t.sent,this.loading=!1,this.$Message.success(d),this.goBack();case 40:case"end":return t.stop()}},t,this,[[15,19,23,31],[24,,26,30]])}));return function(){return t.apply(this,arguments)}}()}},j=R,O=(n("9ff4"),Object(l["a"])(j,s,r,!1,null,"52e14e7a",null));O.options.__file="GroupCreate.vue";e["default"]=O.exports},c753:function(t,e,n){},c75e:function(t,e,n){"use strict";var s=n("2a65"),r=n.n(s);r.a},ca0f:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-user-groups"},[n("common-header",[t._v(t._s(t.title))]),n("main",[n("jo-load-more",{ref:"loadmore",attrs:{"auto-load":!1},on:{onRefresh:t.onRefresh,onLoadMore:t.onLoadMore}},[n("ul",t._l(t.groups,function(t){return n("li",{key:t.id,staticClass:"m-bb1"},[n("group-item",{attrs:{group:t}})],1)}))])],1)],1)},r=[],o=(n("1c4c"),n("c93e")),i=(n("ac6a"),n("f400"),n("2f62")),a=n("74f3"),c=n("23ba"),u={name:"UserGroups",components:{GroupItem:a["a"]},data:function(){var t=new Map;return{preUID:0,GROUPS:t,groupsChangeTracker:1}},computed:Object(o["a"])({},Object(i["d"])(["CURRENTUSER"]),{userID:function(){return~~this.$route.params.userID},title:function(){return this.CURRENTUSER.id===this.userID?"我加入的":"TA的圈子"},groups:function(){return this.groupsChangeTracker&&Array.from(this.GROUPS.values())}}),created:function(){document.title=this.title},mounted:function(){this.preUID!==this.userID&&(this.GROUPS.clear(),this.groupsChangeTracker=1,this.preUID=this.userID),this.$refs.loadmore.beforeRefresh()},methods:{formateGroups:function(t){var e=this;t.forEach(function(t){e.GROUPS.set(t.id,t),e.groupsChangeTracker+=1})},onRefresh:function(){var t=this;Object(c["q"])(this.userID,15).then(function(e){var n=e.data,s=void 0===n?[]:n;t.formateGroups(s),t.$refs.loadmore.afterRefresh(s.length<15)})},onLoadMore:function(){var t=this;Object(c["q"])(this.userID,15,this.groups.length).then(function(e){var n=e.data,s=void 0===n?[]:n;t.formateGroups(s),t.$refs.loadmore.afterLoadMore(s.length<15)})}}},l=u,d=n("2877"),h=Object(d["a"])(l,s,r,!1,null,null,null);h.options.__file="UserGroups.vue";e["default"]=h.exports},caf8:function(t,e,n){"use strict";var s=n("136e"),r=n.n(s);r.a},cb6f:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"c-group-user-item",on:{click:t.onUserClick}},[n("div",{staticClass:"info"},[n("avatar",{staticClass:"avatar",attrs:{user:t.user}}),n("span",{staticClass:"name m-text-cut"},[t._v(t._s(t.user.name))]),"founder"===t.member.role?n("span",{staticClass:"founder"},[t._v("圈主")]):t._e(),"administrator"===t.member.role?n("span",{staticClass:"admin"},[t._v("管理员")]):t._e()],1),n("div",{staticClass:"more",on:{click:function(e){return e.stopPropagation(),t.handleMore(e)}}},[n("svg",{staticClass:"m-style-svg m-svg-small"},[n("use",{attrs:{"xlink:href":"#icon-more"}})])])])},r=[],o={name:"GroupUserItem",props:{member:{type:Object,required:!0}},computed:{user:function(){return this.member.user||{}}},methods:{onUserClick:function(){this.$router.push({name:"userDetail",params:{userId:this.user.id}})},handleMore:function(){this.$emit("more")}}},i=o,a=(n("caf8"),n("2877")),c=Object(a["a"])(i,s,r,!1,null,"160b548c",null);c.options.__file="GroupUserItem.vue";e["a"]=c.exports},da23:function(t,e,n){},dae9:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-group-black-list"},[n("search-bar",{staticClass:"search-bar",model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),t.keyword.length?[n("ul",t._l(t.searchList,function(t){return n("li",{key:t.id},[n("group-user-item",{attrs:{member:t}})],1)}))]:[n("h3",[t._v("黑名单("+t._s(t.blackList.length)+")")]),n("ul",t._l(t.blackList,function(e){return n("li",{key:e.id},[n("group-user-item",{attrs:{member:e},on:{more:function(n){t.onMoreClick(e.id)}}})],1)}))]],2)},r=[],o=(n("96cf"),n("3040")),i=(n("c5f6"),n("2ef0")),a=n.n(i),c=n("3d8d"),u=n("cb6f"),l={name:"GroupBlackList",components:{SearchBar:c["a"],GroupUserItem:u["a"]},data:function(){return{keyword:"",blackList:[],searchList:[]}},computed:{group:function(){return this.$store.state.group.current},groupId:function(){return Number(this.$route.params.groupId)}},watch:{keyword:function(t,e){if(""===t.trim())return this.searchList=[];t.trim()!==e.trim()&&this.searchUser(t)}},mounted:function(){this.group.id||this.fetchGroup(),this.fetchMembers()},methods:{fetchMembers:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("group/getMembers",{groupId:this.groupId,type:"blacklist",limit:100});case 2:e=t.sent,this.blackList=e;case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),fetchGroup:function(){this.$store.dispatch("group/getGroupById",{groupId:this.groupId})},searchUser:a.a.debounce(function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.searchList=[],t.next=3,this.$store.dispatch("group/getMembers",{groupId:this.groupId,name:e,type:"blacklist"});case 3:n=t.sent,this.searchList=n;case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),450),onMoreClick:function(t){var e=this,n=[];n.push({text:"移出黑名单",method:function(){var n=Object(o["a"])(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$store.dispatch("group/moveoutBlackList",{groupId:e.groupId,memberId:t});case 2:e.blackList=e.blackList.filter(function(e){return e.id!==t}),e.$Message.success("操作成功"),e.fetchMembers();case 5:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}()}),this.$bus.$emit("actionSheet",n)}}},d=l,h=(n("739e"),n("2877")),f=Object(h["a"])(d,s,r,!1,null,"1a2ab80c",null);f.options.__file="GroupBlackList.vue";e["default"]=f.exports},dc37:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-group-home"},[n("common-header",[t._v("\n    圈子\n    "),n("template",{slot:"right"},[n("svg",{staticClass:"m-style-svg m-svg-def",on:{click:t.onSearchClick}},[n("use",{attrs:{"xlink:href":"#icon-search"}})]),n("svg",{staticClass:"m-style-svg m-svg-def",on:{click:t.beforeCreateGroup}},[n("use",{attrs:{"xlink:href":"#icon-group-create"}})])])],2),n("main",[n("detail-ad",{attrs:{type:"group:home"}}),n("div",{staticClass:"group-label",on:{click:function(e){t.$router.push({name:"groups",query:{type:"recommend"}})}}},[n("h2",[n("strong",[t._v(t._s(t.groupTotalNumber))]),t._v("个兴趣小组，等待你的加入！")]),n("svg",{staticClass:"m-style-svg m-svg-def m-entry-append"},[n("use",{attrs:{"xlink:href":"#icon-arrow-right"}})])]),n("div",{staticClass:"m-box-model"},[n("router-link",{staticClass:"group-label",attrs:{to:"/users/"+t.user.id+"/group",tag:"div"}},[n("span",[t._v("我加入的")]),n("div",{staticClass:"m-box m-aln-center m-justify-end"},[t.myGroupsCount?t.myGroupsCount>5?n("span",[t._v("查看更多")]):t._e():n("span",[t._v("查看全部")]),n("svg",{staticClass:"m-style-svg m-svg-def m-entry-append"},[n("use",{attrs:{"xlink:href":"#icon-arrow-right"}})])])]),n("ul",{staticClass:"group-list"},t._l(t.groups,function(t){return n("li",{key:"mygroup-"+t.id},[n("group-item",{attrs:{group:t}})],1)}))],1),t.recGroups.length>0?n("div",{staticClass:"m-box-model"},[n("div",{staticClass:"group-label"},[n("span",[t._v("热门推荐")]),n("div",{staticClass:"m-box m-aln-center m-justify-end",on:{click:t.fetchRecGroups}},[n("svg",{staticClass:"m-style-svg m-svg-small",style:{transform:"rotate("+t.clickCount+"turn)"}},[n("use",{attrs:{"xlink:href":"#icon-refresh"}})]),n("span",{staticStyle:{"margin-left":"0.05rem"}},[t._v("换一批")])])]),n("ul",{staticClass:"group-list"},t._l(t.recGroups,function(t){return n("li",{key:"recgroup-"+t.id},[n("group-item",{attrs:{group:t}})],1)}))]):t._e()],1)],1)},r=[],o=(n("96cf"),n("3040")),i=n("8afe"),a=n("c93e"),c=(n("ac6a"),n("f400"),n("2f62")),u=n("74f3"),l=n("9e56"),d=n("23ba"),h={name:"GroupHome",components:{GroupItem:u["a"],DetailAd:l["a"]},data:function(){return{myGroups:new Map,recGroups:[],clickCount:0,groupTotalNumber:0,fetchRecing:!1,myGroupChangeTracker:0,myGroupsCount:0}},computed:Object(a["a"])({},Object(c["d"])({CONFIG:"CONFIG",user:"CURRENTUSER"}),{groups:function(){return this.myGroupChangeTracker&&Object(i["a"])(this.myGroups.values())}}),created:function(){var t=this;this.fetchMyGroups(),this.fetchRecGroups(),d["o"]().then(function(e){t.groupTotalNumber=e})},methods:{formateGroups:function(t){var e=this;t.forEach(function(t){e.myGroups.set(t.id,t),e.myGroupChangeTracker+=1})},fetchMyGroups:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("group/getMyGroups",{limit:6});case 2:e=t.sent,this.myGroupsCount=e.length,this.formateGroups(e.slice(0,5));case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),fetchRecGroups:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.fetchRecing){t.next=2;break}return t.abrupt("return");case 2:return this.fetchRecing=!0,t.next=5,this.$store.dispatch("group/getGroups",{type:"random",limit:5});case 5:e=t.sent,this.recGroups=e,this.clickCount+=1,this.fetchRecing=!1;case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),onSearchClick:function(){this.$router.push({name:"groupSearch"})},beforeCreateGroup:function(){var t=this,e=this.CONFIG["group:create"].need_verified,n=this.user.verified;if(!e||n)return this.$router.push({name:"groupCreate"});var s=[{text:"去认证",method:function(){return t.$router.push({name:"ProfileCertificate"})}}];this.$bus.$emit("actionSheet",s,"取消","认证用户才能创建圈子, 去认证?")}}},f=h,m=(n("40b8"),n("2877")),p=Object(m["a"])(f,s,r,!1,null,"a5d2ddd6",null);p.options.__file="GroupHome.vue";e["default"]=p.exports},dcb0:function(t,e,n){},dcef:function(t,e,n){"use strict";var s=n("a52a"),r=n.n(s);r.a},e83b:function(t,e,n){},e954:function(t,e,n){},ef34:function(t,e,n){},f170:function(t,e,n){}}]);
//# sourceMappingURL=group-9f87108d0d0d21edc2d4.js.map